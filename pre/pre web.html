<!-- 
author: fira and llms (deepseek v3)
created: 2025.08.19
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pre web</title>
    <style>
      :root {
        --bg-color: #1e1e1e;
        --surface-color: #2d2d2d;
        --text-color: #e0e0e0;
        --accent-color: #4a8fe7;
        --border-color: #444;
      }

      body {
        font-family: Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100vh;
        box-sizing: border-box;
      }

      .container {
        width: 100%;
        max-width: 600px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .upload-area,
      .config-area {
        background-color: var(--surface-color);
        border: 2px dashed var(--border-color);
        border-radius: 8px;
        padding: 30px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
      }

      .upload-area:hover,
      .config-area:hover {
        border-color: var(--accent-color);
      }

      .upload-area.highlight {
        border-color: var(--accent-color);
        background-color: rgba(74, 143, 231, 0.1);
      }

      h2 {
        margin-top: 0;
        color: var(--accent-color);
      }

      button {
        background-color: var(--accent-color);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
      }

      button:hover {
        opacity: 0.9;
      }

      #configFilename {
        font-style: italic;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="upload-area" id="uploadArea">
        <h2>Upload Markdown</h2>
        <p>Click, drag & drop, or paste a markdown file</p>
      </div>

      <div class="config-area" id="configArea">
        <h2>Configuration</h2>
        <textarea
          id="configTextarea"
          rows="10"
          style="
            width: 100%;
            background: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 8px;
          "
        ></textarea>
        <button id="uploadConfig">Upload Config</button>
        <div id="configFilename">default</div>
      </div>
    </div>

    <script>
      // Default configuration
      const defaultConfig = {
        theme: {
          options: {
            light: `
        /* Base Styles */
        .pre {
          display: block;
          min-height: 100vh;
          width: 100%;
          box-sizing: border-box;
          padding: 2rem 15% 4rem;
          background-color: #f8f9fa; /* Light but not pure white */
          color: #333;
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
          font-size: 1.5rem;
          line-height: 1.6;
          overflow-y: auto;
          overflow-x: hidden;
          scrollbar-width: thin;
          scrollbar-color: #ccc #f8f9fa;
        }

        /* Text elements */
        .pre h1, .pre h2, .pre h3, .pre h4, .pre h5, .pre h6 {
          margin-top: 1.5em;
          margin-bottom: 0.75em;
          line-height: 1.2;
          font-weight: 600;
        }

        .pre h1 { font-size: 2.5em; }
        .pre h2 { font-size: 2em; }
        .pre h3 { font-size: 1.75em; }
        .pre h4 { font-size: 1.5em; }
        .pre h5 { font-size: 1.25em; }
        .pre h6 { font-size: 1em; }

        .pre p {
          margin-top: 1em;
          margin-bottom: 1em;
        }

        .pre strong {
          font-weight: bold;
        }

        .pre em {
          font-style: italic;
        }

        /* Lists */
        .pre ul, .pre ol {
          margin: 1em 0;
          padding-left: 2em;
        }

        .pre li {
          margin-bottom: 0.5em;
        }

        /* Links */
        .pre a {
          color: #0969da;
          text-decoration: none;
        }

        .pre a:hover {
          text-decoration: underline;
        }

        /* Code blocks (Prism handles syntax highlighting) */
        .pre pre[class*="language-"] {
          border-radius: 6px;
          margin: 1.5em 0;
          overflow: auto;
          padding: 1em;
          background-color: #f6f8fa;
        }

        .pre code:not([class*="language-"]) {
          background-color: #f6f8fa;
          border-radius: 3px;
          padding: 0.2em 0.4em;
          font-size: 0.9em;
        }

        /* Images */
        .pre img {
          max-width: 100%;
          height: auto;
          display: block;
          margin: 1.5em auto;
          border-radius: 4px;
        }

        /* Blockquotes */
        .pre blockquote {
          border-left: 4px solid #dfe2e5;
          color: #57606a;
          margin: 1.5em 0;
          padding: 0 1em;
        }

        /* Tables */
        .pre table {
          border-collapse: collapse;
          width: 100%;
          margin: 1.5em 0;
        }

        .pre th, .pre td {
          border: 1px solid #dfe2e5;
          padding: 0.5em 1em;
          text-align: left;
        }

        .pre th {
          background-color: #f6f8fa;
          font-weight: 600;
        }

        /* Horizontal rule */
        .pre hr {
          border: none;
          border-top: 1px solid #dfe2e5;
          margin: 2em 0;
        }

        /* Scrollbar styling */
        .pre::-webkit-scrollbar {
          width: 8px;
          height: 8px;
        }

        .pre::-webkit-scrollbar-track {
          background: #f8f9fa;
        }

        .pre::-webkit-scrollbar-thumb {
          background-color: #ccc;
          border-radius: 4px;
        }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
          .pre {
            padding-left: 10%;
            padding-right: 10%;
          }
        }

        @media (max-width: 768px) {
          .pre {
            padding-left: 5%;
            padding-right: 5%;
            font-size: 1.3rem;
          }
        }`,
            dark: `
        /* Base styles */
        .pre {
          /* Full screen layout */
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          overflow-y: auto;
          overflow-x: hidden;

          /* Dark theme colors */
          background-color: #121212;
          color: #e0e0e0;

          /* Typography */
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
          line-height: 1.6;
          font-size: 1.5rem;

          /* Content layout */
          padding: 2rem 15% 4rem;
          box-sizing: border-box;
          max-width: 100%;
        }

        /* Text elements */
        .pre h1, .pre h2, .pre h3, .pre h4, .pre h5, .pre h6 {
          color: #ffffff;
          margin-top: 1.5em;
          margin-bottom: 0.75em;
          line-height: 1.2;
        }

        .pre h1 {
          font-size: 2.5rem;
          border-bottom: 1px solid #333;
          padding-bottom: 0.5rem;
        }

        .pre h2 {
          font-size: 2rem;
        }

        .pre h3 {
          font-size: 1.75rem;
        }

        .pre p {
          margin: 1em 0;
        }

        .pre strong {
          font-weight: bold;
          color: #ffffff;
        }

        .pre em {
          font-style: italic;
        }

        .pre a {
          color: #64b5f6;
          text-decoration: none;
        }

        .pre a:hover {
          text-decoration: underline;
        }

        /* Lists */
        .pre ul, .pre ol {
          margin: 1em 0;
          padding-left: 2em;
        }

        .pre li {
          margin: 0.5em 0;
        }

        /* Code blocks (Prism handles syntax highlighting) */
        .pre pre[class*="language-"] {
          background-color: #1e1e1e;
          border-radius: 4px;
          padding: 1em;
          margin: 1.5em 0;
          overflow: auto;
          max-width: 100%;
        }

        .pre code {
          font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
          background-color: #1e1e1e;
          padding: 0.2em 0.4em;
          border-radius: 3px;
          font-size: 0.9em;
        }

        /* Images */
        .pre img {
          max-width: 100%;
          height: auto;
          display: block;
          margin: 1.5em auto;
        }

        /* Blockquotes */
        .pre blockquote {
          border-left: 4px solid #333;
          padding-left: 1em;
          margin: 1.5em 0;
          color: #b0b0b0;
        }

        /* Tables */
        .pre table {
          border-collapse: collapse;
          width: 100%;
          margin: 1.5em 0;
        }

        .pre th, .pre td {
          border: 1px solid #333;
          padding: 0.5em 1em;
          text-align: left;
        }

        .pre th {
          background-color: #1e1e1e;
          color: #ffffff;
        }

        /* Horizontal rule */
        .pre hr {
          border: none;
          border-top: 1px solid #333;
          margin: 2em 0;
        }

        /* Scrollbar styling */
        .pre::-webkit-scrollbar {
          width: 10px;
          height: 10px;
        }

        .pre::-webkit-scrollbar-track {
          background: #1e1e1e;
        }

        .pre::-webkit-scrollbar-thumb {
          background: #555;
          border-radius: 5px;
        }

        .pre::-webkit-scrollbar-thumb:hover {
          background: #777;
        }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
          .pre {
            padding-left: 10%;
            padding-right: 10%;
          }
        }

        @media (max-width: 768px) {
          .pre {
            padding-left: 5%;
            padding-right: 5%;
            font-size: 1.3rem;
          }
        }`,
            dark2: `/* Base styles */
.pre {
  /* Full screen layout */
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow-y: auto;
  overflow-x: hidden;
  
  /* Dark theme colors */
  background-color: #121212;
  color: #e0e0e0;
  
  /* Typography */
  /* font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; */
  line-height: 1.6;
  font-size: 1.5rem;
  
  /* Content layout */
  padding: 2rem 15% 4rem;
  box-sizing: border-box;
  max-width: 100%;
}

.pre * {
  font-family: "Fira Sans", "Noto Serif CJK SC";
}

/* Text elements */
.pre h1, .pre h2, .pre h3, .pre h4, .pre h5, .pre h6 {
  color: #ffffff;
  margin-top: 1.5em;
  margin-bottom: 0.75em;
  line-height: 1.2;
}

.pre h1 {
  font-size: 2.5rem;
  border-bottom: 1px solid #333;
  padding-bottom: 0.5rem;
}

.pre h2 {
  font-size: 2rem;
}

.pre h3 {
  font-size: 1.75rem;
}

.pre p {
  margin: 1em 0;
}

.pre strong {
  font-weight: bold;
  color: #ffffff;
}

.pre em {
  font-style: italic;
}

.pre a {
  color: #64b5f6;
  text-decoration: none;
}

.pre a:hover {
  text-decoration: underline;
}

/* Lists */
.pre ul, .pre ol {
  margin: 1em 0;
  padding-left: 2em;
}

.pre li {
  margin: 0.5em 0;
}

/* Code blocks (Prism handles syntax highlighting) */
.pre pre[class*="language-"] {
  background-color: #1e1e1e;
  border-radius: 4px;
  padding: 1em;
  margin: 1.5em 0;
  overflow: auto;
  max-width: 100%;
}

.pre code {
  font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
  background-color: #1e1e1e;
  padding: 0.2em 0.4em;
  border-radius: 3px;
  font-size: 0.9em;
}

/* Images */
.pre img {
  max-width: 100%;
  height: auto;
  display: block;
  margin: 1.5em auto;
}

/* Blockquotes */
.pre blockquote {
  margin: 1.5em 0;
  opacity: 50%;
}

/* Tables */
.pre table {
  border-collapse: collapse;
  width: 100%;
  margin: 1.5em 0;
}

.pre th, .pre td {
  border: 1px solid #333;
  padding: 0.5em 1em;
  text-align: left;
}

.pre th {
  background-color: #1e1e1e;
  color: #ffffff;
}

/* Horizontal rule */
.pre hr {
  border: none;
  border-top: 1px solid #333;
  margin: 2em 0;
}

/* Scrollbar styling */
.pre::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

.pre::-webkit-scrollbar-track {
  background: #1e1e1e;
}

.pre::-webkit-scrollbar-thumb {
  background: #555;
  border-radius: 5px;
}

.pre::-webkit-scrollbar-thumb:hover {
  background: #777;
}

/* Responsive adjustments */
@media (max-width: 1200px) {
  .pre {
    padding-left: 10%;
    padding-right: 10%;
  }
}

@media (max-width: 768px) {
  .pre {
    padding-left: 5%;
    padding-right: 5%;
    font-size: 1.3rem;
  }
}`,
          },
          default: "dark2",
        },
        codeTheme: {
          options: {
            dracula: `/**
     * Dracula Theme originally by Zeno Rocha [@zenorocha]
     * https://draculatheme.com/
     *
     * Ported for PrismJS by Albert Vallverdu [@byverdu]
     */

    code[class*="language-"],
    pre[class*="language-"] {
    	color: #f8f8f2;
    	background: none;
    	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
    	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    	text-align: left;
    	white-space: pre;
    	word-spacing: normal;
    	word-break: normal;
    	word-wrap: normal;
    	line-height: 1.5;
    	-moz-tab-size: 4;
    	-o-tab-size: 4;
    	tab-size: 4;
    	-webkit-hyphens: none;
    	-moz-hyphens: none;
    	-ms-hyphens: none;
    	hyphens: none;
    }

    /* Code blocks */
    pre[class*="language-"] {
    	padding: 1em;
    	margin: .5em 0;
    	overflow: auto;
    	border-radius: 0.3em;
    }

    :not(pre) > code[class*="language-"],
    pre[class*="language-"] {
    	background: #282a36;
    }

    /* Inline code */
    :not(pre) > code[class*="language-"] {
    	padding: .1em;
    	border-radius: .3em;
    	white-space: normal;
    }

    .token.comment,
    .token.prolog,
    .token.doctype,
    .token.cdata {
    	color: #6272a4;
    }

    .token.punctuation {
    	color: #f8f8f2;
    }

    .namespace {
    	opacity: .7;
    }

    .token.property,
    .token.tag,
    .token.constant,
    .token.symbol,
    .token.deleted {
    	color: #ff79c6;
    }

    .token.boolean,
    .token.number {
    	color: #bd93f9;
    }

    .token.selector,
    .token.attr-name,
    .token.string,
    .token.char,
    .token.builtin,
    .token.inserted {
    	color: #50fa7b;
    }

    .token.operator,
    .token.entity,
    .token.url,
    .language-css .token.string,
    .style .token.string,
    .token.variable {
    	color: #f8f8f2;
    }

    .token.atrule,
    .token.attr-value,
    .token.function,
    .token.class-name {
    	color: #f1fa8c;
    }

    .token.keyword {
    	color: #8be9fd;
    }

    .token.regex,
    .token.important {
    	color: #ffb86c;
    }

    .token.important,
    .token.bold {
    	font-weight: bold;
    }

    .token.italic {
    	font-style: italic;
    }

    .token.entity {
    	cursor: help;
    }
    `,
          },
          default: "dracula",
        },
      };

      let currentConfig = { ...defaultConfig };
      document.getElementById("configTextarea").value = JSON.stringify(
        defaultConfig,
        null,
        2
      );

      // Upload area functionality
      const uploadArea = document.getElementById("uploadArea");

      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ["dragenter", "dragover"].forEach((eventName) => {
        uploadArea.addEventListener(eventName, highlight, false);
      });

      ["dragleave", "drop"].forEach((eventName) => {
        uploadArea.addEventListener(eventName, unhighlight, false);
      });

      function highlight() {
        uploadArea.classList.add("highlight");
      }

      function unhighlight() {
        uploadArea.classList.remove("highlight");
      }

      uploadArea.addEventListener("drop", handleDrop, false);
      uploadArea.addEventListener("click", () =>
        document.getElementById("fileInput")?.click()
      );

      // Handle paste event
      document.addEventListener("paste", handlePaste);

      // Create hidden file input
      const fileInput = document.createElement("input");
      fileInput.type = "file";
      fileInput.id = "fileInput";
      fileInput.accept = ".md,.markdown";
      fileInput.style.display = "none";
      document.body.appendChild(fileInput);

      fileInput.addEventListener("change", handleFiles);

      function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles({ target: { files } });
      }

      function handlePaste(e) {
        const items = (e.clipboardData || e.originalEvent.clipboardData).items;
        for (let item of items) {
          if (
            item.kind === "file" &&
            item.type.match("^text/markdown|text/x-markdown")
          ) {
            const file = item.getAsFile();
            handleFiles({ target: { files: [file] } });
            break;
          }
        }
      }

      function handleFiles(e) {
        const file = e.target.files[0];
        if (!file || !file.name.match(/\.(md|markdown)$/i)) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          const markdownContent = e.target.result;
          const result = {
            file: markdownContent,
            config: currentConfig,
          };

          // Call the render function (assumed to exist)
          const htmlContent = render(result);

          // Download the HTML file
          downloadFile(
            htmlContent,
            file.name.replace(/\.[^/.]+$/, "") + ".html"
          );
        };
        reader.readAsText(file);
      }

      // Config area functionality
      document.getElementById("uploadConfig").addEventListener("click", () => {
        document.getElementById("configInput")?.click();
      });

      const configInput = document.createElement("input");
      configInput.type = "file";
      configInput.id = "configInput";
      configInput.accept = ".json";
      configInput.style.display = "none";
      document.body.appendChild(configInput);

      configInput.addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (!file || !file.name.match(/\.json$/i)) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            currentConfig = JSON.parse(e.target.result);
            document.getElementById("configTextarea").value = JSON.stringify(
              currentConfig,
              null,
              2
            );
            document.getElementById("configFilename").textContent = file.name;
          } catch (error) {
            alert("Invalid JSON file");
          }
        };
        reader.readAsText(file);
      });

      // Helper function to download files
      function downloadFile(content, filename) {
        const blob = new Blob([content], { type: "text/html" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }, 0);
      }
    </script>
  </body>

  <!-- Markdown-it core + plugins -->
  <script src="lib/markdown-it.min.js"></script>
  <script src="lib/markdown-it-emoji.min.js"></script>
  <script src="lib/markdown-it-task-lists.min.js"></script>

  <!-- PrismJS - Load specific languages you need -->
  <script src="lib/prism.min.js"></script>

  <!-- todo: add all languages supported by prism. 
   some languages may raise "set undefined.foo" error for wrong loading order. -->
  <!-- Add language components you need, example: -->
  <script src="lib/components/prism-c.js"></script>
  <script src="lib/components/prism-cpp.js"></script>
  <script src="lib/components/prism-java.js"></script>
  <script src="lib/components/prism-python.js"></script>
  <script src="lib/components/prism-markup.js"></script>
  <script src="lib/components/prism-markup-templating.js"></script>
  <script src="lib/components/prism-javascript.js"></script>
  <script src="lib/components/prism-typescript.js"></script>
  <script src="lib/components/prism-jsx.js"></script>
  <script src="lib/components/prism-tsx.js"></script>
  <script src="lib/components/prism-php.js"></script>
  <script src="lib/components/prism-csharp.js"></script>
  <script src="lib/components/prism-go.js"></script>
  <script src="lib/components/prism-ruby.js"></script>
  <script src="lib/components/prism-swift.js"></script>
  <script src="lib/components/prism-kotlin.js"></script>
  <script src="lib/components/prism-rust.js"></script>
  <script src="lib/components/prism-sql.js"></script>
  <script src="lib/components/prism-bash.js"></script>
  <script src="lib/components/prism-json.js"></script>
  <script src="lib/components/prism-css.js"></script>
  <script src="lib/components/prism-git.js"></script>
  <script src="lib/components/prism-docker.js"></script>
  <script src="lib/components/prism-markdown.js"></script>
  <script src="lib/components/prism-graphql.js"></script>

  <!-- todo: replace with katex. (or not for more syntax support?) -->
  <!-- MathJax -->
  <script src="lib/tex-mml-chtml.js"></script>

  <script src="convert.js"></script>
  <script src="render.js"></script>
</html>
