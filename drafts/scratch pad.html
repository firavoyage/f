<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>React + Pixi Demo</title>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel so we can use JSX directly -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Pixi.js (version 7.x) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.2.4/pixi.min.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #111;
      color: white;
      font-family: sans-serif;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">

    function GameCanvas({ x }) {
      const canvasRef = React.useRef(null);
      const pixiApp = React.useRef(null);
      const sprite = React.useRef(null);

      // 1. Create Pixi App only once
      React.useEffect(() => {
        pixiApp.current = new PIXI.Application({
          width: window.innerWidth,
          height: window.innerHeight,
          background: "#202020"
        });

        // append Pixi view (canvas) into the DOM div
        canvasRef.current.appendChild(pixiApp.current.view);

        // Create a simple graphic to animate
        sprite.current = new PIXI.Graphics();
        sprite.current.beginFill(0xff66aa);
        sprite.current.drawCircle(0, 0, 50);
        sprite.current.endFill();
        pixiApp.current.stage.addChild(sprite.current);

        return () => {
          pixiApp.current.destroy(true);
        };
      }, []);

      // 2. React passes new "x" prop → we update Pixi
      React.useEffect(() => {
        if (sprite.current) {
          sprite.current.x = x;
          sprite.current.y = window.innerHeight / 2;
        }
      }, [x]);

      return <div ref={canvasRef}></div>;
    }


    // simple React UI that moves a circle left and right
    function App() {
      const [x, setX] = React.useState(200);

      return (
        <div>
          <GameCanvas x={x} />

          <div style={{
            position: "absolute",
            top: 20,
            left: 20,
            background: "#0007",
            padding: "12px 18px",
            borderRadius: "8px"
          }}>
            <button onClick={() => setX(x - 20)}>← left</button>
            <button onClick={() => setX(x + 20)}>right →</button>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);

  </script>
</body>
</html>
