<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Presentation</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/core.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github-dark.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #121212;
            color: #e0e0e0;
            font-family: Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .upload-area {
            border: 2px dashed #444;
            border-radius: 5px;
            padding: 2rem;
            text-align: center;
            margin: 2rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-area:hover {
            border-color: #666;
            background-color: #1e1e1e;
        }
        .slide-container {
            display: none;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem;
            box-sizing: border-box;
        }
        .slide {
            flex: 1;
            overflow-y: auto;
        }
        .current-slide {
            display: flex;
        }
        .slide-number {
            text-align: center;
            padding: 0.5rem;
            color: #666;
        }
        pre {
            border-radius: 5px;
            padding: 1rem;
            overflow-x: auto;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="upload-area" class="upload-area">
            <h2>Upload Markdown Presentation</h2>
            <p>Drag & drop, paste, or click to upload a markdown file</p>
            <input type="file" id="file-input" accept=".md,.markdown" style="display: none;">
        </div>
        <div id="presentation" style="display: none;">
            <div id="slide-container" class="slide-container">
                <div id="slide" class="slide"></div>
                <div id="slide-number" class="slide-number"></div>
            </div>
        </div>
    </div>

    <script>
        marked.setOptions({
            highlight: function(code, lang) {
                const language = hljs.getLanguage(lang) ? lang : 'plaintext';
                return hljs.highlight(code, { language }).value;
            },
            langPrefix: 'hljs language-'
        });

        let slides = [];
        let currentSlide = 0;

        document.getElementById('upload-area').addEventListener('click', () => {
            document.getElementById('file-input').click();
        });

        document.getElementById('file-input').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                readFile(file);
            }
        });

        document.addEventListener('dragover', (e) => {
            e.preventDefault();
            document.getElementById('upload-area').style.borderColor = '#666';
            document.getElementById('upload-area').style.backgroundColor = '#1e1e1e';
        });

        document.addEventListener('dragleave', () => {
            document.getElementById('upload-area').style.borderColor = '#444';
            document.getElementById('upload-area').style.backgroundColor = 'transparent';
        });

        document.addEventListener('drop', (e) => {
            e.preventDefault();
            document.getElementById('upload-area').style.borderColor = '#444';
            document.getElementById('upload-area').style.backgroundColor = 'transparent';
            
            const file = e.dataTransfer.files[0];
            if (file && (file.name.endsWith('.md') || file.name.endsWith('.markdown'))) {
                readFile(file);
            }
        });

        document.addEventListener('paste', (e) => {
            const items = e.clipboardData.items;
            for (let i = 0; i < items.length; i++) {
                if (items[i].kind === 'file' && 
                    (items[i].type === 'text/markdown' || 
                     items[i].type === 'text/x-markdown' ||
                     items[i].type === 'text/plain')) {
                    const file = items[i].getAsFile();
                    readFile(file);
                    break;
                }
            }
        });

        document.addEventListener('keydown', (e) => {
            if (slides.length === 0) return;
            
            if (e.key === 'j' || e.key === 'ArrowDown') {
                if (currentSlide < slides.length - 1) {
                    currentSlide++;
                    renderSlide();
                }
                e.preventDefault();
            } else if (e.key === 'k' || e.key === 'ArrowUp') {
                if (currentSlide > 0) {
                    currentSlide--;
                    renderSlide();
                }
                e.preventDefault();
            }
        });

        function readFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const content = e.target.result;
                processMarkdown(content);
            };
            reader.readAsText(file);
        }

        function processMarkdown(markdown) {
            // Split by headers (lines starting with #)
            const headerRegex = /^(#+ .*)$/gm;
            const parts = markdown.split(headerRegex);
            
            slides = [];
            let currentSlideContent = '';
            
            for (let i = 0; i < parts.length; i++) {
                if (parts[i].match(headerRegex)) {
                    if (currentSlideContent) {
                        slides.push(currentSlideContent);
                    }
                    currentSlideContent = parts[i] + '\n';
                } else if (parts[i].trim()) {
                    currentSlideContent += parts[i] + '\n';
                }
            }
            
            if (currentSlideContent) {
                slides.push(currentSlideContent);
            }
            
            if (slides.length > 0) {
                document.getElementById('upload-area').style.display = 'none';
                document.getElementById('presentation').style.display = 'block';
                currentSlide = 0;
                renderSlide();
            }
        }

        function renderSlide() {
            const slideElement = document.getElementById('slide');
            slideElement.innerHTML = marked.parse(slides[currentSlide]);
            
            const slideNumberElement = document.getElementById('slide-number');
            slideNumberElement.textContent = `${currentSlide + 1} / ${slides.length}`;
            
            // Scroll to top when changing slides
            slideElement.scrollTop = 0;
        }
    </script>
</body>
</html>