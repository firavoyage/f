const version="1.0",{h:h,p:p,e:e,r:r}=voyage,stylesheet={".page":"pos-fixed inset-0 max-w-full box-border m-0 overflow-hidden\n  bg-gray-900","*":"fill-none stroke-5px stroke-gray-50",".point":"fill-gray-50 stroke-none",".point.selected":"fill-lightblue stroke-none"},theme={color:{gray:{50:"#f6f7f9",800:"#343a46",900:"#23272f"}}},line=e=>{if(!e.length)return"";const[t,...r]=e;let o=`M${t.x},${t.y}`;return r.forEach((e=>{o+=` L${e.x},${e.y}`})),o},curve=e=>{if(0===e.length)return"";if(1===e.length)return`M ${e[0].x} ${e[0].y}`;const t=[];t.push(`M ${e[0].x} ${e[0].y}`);for(let r=0;r<e.length-1;r++){const o=e[r-1]||e[r],n=e[r],s=e[r+1],i=e[r+2]||s,l=n.x+(s.x-o.x)/6,a=n.y+(s.y-o.y)/6,c=s.x-(i.x-n.x)/6,p=s.y-(i.y-n.y)/6;t.push(`C ${l} ${a}, ${c} ${p}, ${s.x} ${s.y}`)}return t.join(" ")},ellipse=e=>{if(!Array.isArray(e))return!1;const t=e.length;if(0===t)return!1;for(let r=0;r<t;r++){const t=e[r];if("number"!=typeof t.x||"number"!=typeof t.y||isNaN(t.x)||isNaN(t.y))return!1}if(1===t)return{o:{x:e[0].x,y:e[0].y},rx:1,ry:1,rotate:0};if(2===t){const t=e[0],r=e[1],o=r.x-t.x,n=r.y-t.y,s=Math.sqrt(o*o+n*n)/2;return{o:{x:(t.x+r.x)/2,y:(t.y+r.y)/2},rx:s,ry:s,rotate:0}}let r=0,o=0;for(const t of e)r+=t.x,o+=t.y;const n={x:r/t,y:o/t},s=e.map((e=>({x:e.x-n.x,y:e.y-n.y})));let i=0,l=0,a=0;for(const e of s)i+=e.x*e.x,l+=e.y*e.y,a+=e.x*e.y;i/=t-1,l/=t-1,a/=t-1;const c=i*l-a*a;if(Math.abs(c)<1e-10)return!1;const p=i+l,y=Math.sqrt(p*p-4*c),h=(p+y)/2,d=(p-y)/2;let u;u=0!==a?[h-l,a]:i>=l?[1,0]:[0,1];const x=Math.sqrt(u[0]*u[0]+u[1]*u[1]);u=[u[0]/x,u[1]/x];let m=0;for(const e of s){const t=e.x*u[0]+e.y*u[1],r=e.x*-u[1]+e.y*u[0],o=t*t/h+r*r/d;o>m&&(m=o)}const f=Math.sqrt(h*m),g=Math.sqrt(d*m);let v=Math.atan2(u[1],u[0])*(180/Math.PI);return v<0&&(v+=360),{o:n,rx:f,ry:g,rotate:360-v}},zoom=e=>{const t=t=>{t.ctrlKey&&(t.preventDefault(),e(t.deltaY<0?1:0))},r=t=>{t.ctrlKey&&("Equal"===t.code||"NumpadAdd"===t.code?(t.preventDefault(),e(1)):"Minus"!==t.code&&"NumpadSubtract"!==t.code||(t.preventDefault(),e(0)))};return document.addEventListener("wheel",t,{passive:!1}),document.addEventListener("keydown",r),()=>{document.removeEventListener("wheel",t),document.removeEventListener("keydown",r)}},open=()=>new Promise((e=>{const t=document.createElement("input");t.type="file",t.accept="*/*",t.onchange=t=>{const r=t.target.files[0];if(!r)return void e(!1);const o=new FileReader;o.onload=t=>{e(t.target.result.toString())},o.onerror=()=>{e(!1)},o.readAsText(r)},t.click()})),save=(e,t)=>{const r=new Blob([t],{type:"text/plain"}),o=URL.createObjectURL(r),n=document.createElement("a");n.href=o,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)},app=()=>{const t=p({materials:{0:{type:"point",props:{point:{x:0,y:0}}}},next:1,history:{history:{},current:0}}),r=(e,r=!1)=>{t.produce((t=>{const o=t.next++;t.materials[o]=e,r&&a.produce((e=>{e.push(o)})),t.history.history[t.history.current++]=t.materials}))},o=10,n=5,s=.8,i=1.25,l=p({width:window.innerWidth,height:window.innerHeight,max:o}),a=p([]),c=p(!1),{has:y,map:d,values:u}=f,x=({x:e,y:t})=>{const{width:r,height:o,max:n}=l(),s=r/n;return{x:e*s+r/2,y:o/2-t*s}},m=({x:e,y:t})=>{const{width:r,height:o,max:n}=l(),s=r/n;return{x:(e-r/2)/s,y:(o/2-t)/s}},g={point:e=>({type:"point",props:{point:e}}),line:e=>({type:"line",props:{points:e}}),curve:e=>({type:"curve",props:{points:e}}),polygon:e=>({type:"polygon",props:{points:e}}),ellipse:e=>({type:"ellipse",props:{...e}})},v=()=>{l("width",window.innerWidth),l("height",window.innerHeight)},w=e=>{l.produce((t=>{0==e?t.max*=i:1==e&&(t.max*=s)}))};return e((()=>{const e=addEventListener("resize",v),n=[];return n.push((()=>removeEventListener("resize",e)),zoom(w),mouse({click(e){r(g.point(m(e)))},"ctrl click"(e){r(g.point(m(e)),!0)}}),listen({"ctrl 0"(){l.produce((e=>{e.max=o}))},l(){const e=d(a(),(e=>t().materials[e].props.point));r(g.line(e)),d(a(),(e=>{t.produce((t=>{delete t.materials[e]}))})),a([])},c(){const e=d(a(),(e=>t().materials[e].props.point));r(g.curve(e)),d(a(),(e=>{t.produce((t=>{delete t.materials[e]}))})),a([])},p(){const e=d(a(),(e=>t().materials[e].props.point));r(g.polygon(e)),d(a(),(e=>{t.produce((t=>{delete t.materials[e]}))})),a([])},e(){const e=d(a(),(e=>t().materials[e].props.point));r(g.ellipse(ellipse(e))),d(a(),(e=>{t.produce((t=>{delete t.materials[e]}))})),a([])},esc(){a([])},"ctrl o"(){const e=new Promise((e=>{const t=document.createElement("input");t.type="file",t.accept="*/*",t.onchange=t=>{const r=t.target.files[0];if(!r)return void e(!1);const o=new FileReader;o.onload=t=>{e(t.target.result.toString())},o.onerror=()=>{e(!1)},o.readAsText(r)},t.click()}));e.then((e=>{e&&t.produce((t=>{t.materials=JSON.parse(e)}))}))},"ctrl s"(){save("materials.json",JSON.stringify(t().materials))},"ctrl z"(){t.produce((e=>{y(e.history.history,e.history.current-1)&&(e.materials=e.history.history[--e.history.current])}))}})),c(!0),()=>{d(n,(e=>e()))}})),c()&&h(h("style",{html:flair({stylesheet:stylesheet,theme:theme})}),h("svg",{class:"page",width:`${l().width}px`,height:`${l().height}px`,viewBox:`0 0 ${l().width} ${l().height}`},...(e=>{const{width:t,height:r,max:o}=l(),s=t/o,i={point({point:e}){const t=x(e);return["circle",{class:"point",cx:t.x,cy:t.y,r:n}]},line:({points:e})=>["path",{d:line(d(e,x))}],curve:({points:e})=>["path",{d:curve(d(e,x))}],polygon:({points:e})=>["polygon",{points:d(d(e,x),(e=>`${e.x},${e.y}`)).join(" ")}],ellipse({o:e,rx:t,ry:r,rotate:o=0}){const n=x(e);return["ellipse",{cx:n.x,cy:n.y,rx:t*s,ry:r*s,transform:`rotate(${o},${n.x},${n.y})`}]}};return d(e,(([e,t])=>{const{type:r,props:o}=t,n=i[r](o);return a().includes(+e)&&(y(n[1],"class")||(n[1].class=""),n[1].class+=" selected"),h(...n)}))})(t().materials)))};r(app,document.body);