<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>material</title>
    <style>/* http://meyerweb.com/eric/tools/css/reset/ 
   v2.0 | 20110126
   License: none (public domain)
*/

html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed, 
figure, figcaption, footer, header, hgroup, 
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
	margin: 0;
	padding: 0;
	border: 0;
	font-size: 100%;
	font: inherit;
	vertical-align: baseline;
}
/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure, 
footer, header, hgroup, menu, nav, section {
	display: block;
}
body {
	line-height: 1;
}
ol, ul {
	list-style: none;
}
blockquote, q {
	quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
	content: '';
	content: none;
}
table {
	border-collapse: collapse;
	border-spacing: 0;
}</style>
  </head>
  <body></body>
  <script>const f={is:(r,t)=>null!=r&&("array"==t?Array.isArray(r):"function"==typeof t?r instanceof t:typeof r==t),has(r,...t){const{is:e}=f;if(!e(r,"object"))return!1;let n=r;for(const r of t){if(!Object.prototype.hasOwnProperty.call(n,r))return!1;n=n[r]}return!0},keys:r=>Object.keys(r),values:r=>Object.values(r),each:r=>Array.from({length:r+1},((r,t)=>t)),flatten(r,t){const{is:e,map:n}=f;let o={},s=r;for(;;){const r={};if(n(s,(([s,c])=>{"object"==typeof c?n(c,(([n,o])=>{""==n?r[s]=o:e(t,"string")?r[`${s}${t}${n}`]=o:e(t,"function")&&(r[t(s,n)]=o)})):o[s]=c})),s=r,0==Object.keys(s).length)break}return o},map(r,t){if(Array.isArray(r))return r.map(t);{const e=Object.entries(r).map(t);return e.every((r=>Array.isArray(r)&&r.length>=2))?Object.fromEntries(e):e}},generate:(r,t,e)=>Object.fromEntries(Array.from({length:e-t+1},((r,e)=>t+e)).map((t=>[t,r(t)]))),merge(r,t){const e=r=>"object"==typeof r&&null!==r,n=r=>{if(!e(r))return r;const t=Array.isArray(r)?[...r]:{...r},n=[{original:r,copy:t}];for(;n.length>0;){const{original:r,copy:t}=n.pop();for(const o in r)if(r.hasOwnProperty(o)){const s=r[o];if(e(s)){const r=Array.isArray(s)?[...s]:{...s};t[o]=r,n.push({original:s,copy:r})}}}return t},o=n(r);if(e(o)&&e(t)){const r=[{source:t,result:o}];for(;r.length>0;){const{source:t,result:o}=r.pop();for(const s in t)if(t.hasOwnProperty(s)){const c=t[s],a=o[s];o.hasOwnProperty(s)?e(a)&&e(c)&&r.push({source:c,result:a}):o[s]=n(c)}}}return o}};</script>
  <script>// update 2025.09.21 23:24 fix!: make "ctrl 0" work

/**
 * @typedef {Object.<string, function(KeyboardEvent): void>} KeyBindings
 * An object mapping key combinations to callback functions.
 * Key combinations are space-separated strings (e.g., 'ctrl c', 'a b c').
 * Callbacks receive the native KeyboardEvent as an argument.
 */

/**
 * Creates a keyboard shortcut listener that handles multiple key combinations.
 * @param {KeyBindings} bindings - An object where keys are key combinations and values are callback functions.
 * @returns {function(): void} A cleanup function that removes all event listeners when called.
 *
 * @example
 * // Basic usage with single key combination
 * const unsubscribe = listen({
 *   'ctrl c': (event) => {
 *     console.log('Copy triggered', event);
 *   },
 *   'ctrl v': (event) => {
 *     console.log('Paste triggered', event);
 *   }
 * });
 *
 * @example
 * // Multi-key combination and cleanup
 * const unsubscribe = listen({
 *   'a b c': (event) => {
 *     console.log('A, B, and C pressed together');
 *     event.preventDefault();
 *   },
 *   'shift space': (event) => {
 *     console.log('Shift + Space pressed');
 *   }
 * });
 *
 * // Later, to remove all listeners:
 * unsubscribe();
 *
 * @example
 * // Order normalization (these are equivalent)
 * listen({
 *   'ctrl alt delete': (e) => { /* handler *\/ },
 *   'alt delete ctrl': (e) => { /* same handler *\/ } // Will trigger same callback
 * });
 */
const listen = (bindings) => {
  const keyStates = {};
  const activeBindings = new Map();

  // Key mapping for normalization
  const keyMapping = {
    ctrl: "control",
    esc: "escape",
    left: "arrowleft",
    right: "arrowright",
    up: "arrowup",
    down: "arrowdown",
    " ": "space",
    space: "space",
  };

  // Normalize and store bindings
  Object.entries(bindings).forEach(([keys, callback]) => {
    const keyArr = keys
      .toLowerCase()
      .split(" ")
      .map((k) => keyMapping[k] || k) // Map keys to normalized names
      .filter(Boolean); // Remove empty strings

    const normalizedKeys = keyArr.sort().join(" ");
    activeBindings.set(normalizedKeys, callback);
  });

  const resetKeyStates = () => {
    for (const key in keyStates) {
      keyStates[key] = false;
    }
  };

  const handleKeyDown = (e) => {
    // Normalize key name using mapping or default to lowercase
    let key = keyMapping[e.key.toLowerCase()] || e.key.toLowerCase();
    keyStates[key] = true;

    // Get current combination of pressed keys
    const currentCombo = Object.keys(keyStates)
      .filter((k) => keyStates[k])
      .sort()
      .join(" ");

    if (activeBindings.has(currentCombo)) {
      e.preventDefault();
      activeBindings.get(currentCombo)(e);
    }
  };

  const handleKeyUp = (e) => {
    let key = keyMapping[e.key.toLowerCase()] || e.key.toLowerCase();
    keyStates[key] = false;
  };

  const handleBlur = () => {
    resetKeyStates();
  };

  document.addEventListener("keydown", handleKeyDown);
  document.addEventListener("keyup", handleKeyUp);
  window.addEventListener("blur", handleBlur);

  // Return unsubscribe function
  return () => {
    document.removeEventListener("keydown", handleKeyDown);
    document.removeEventListener("keyup", handleKeyUp);
    window.removeEventListener("blur", handleBlur);
    resetKeyStates();
    activeBindings.clear();
  };
};

// const listen = (bindings) => {
//   const keyStates = {};
//   const activeBindings = new Map();

//   // Parse and store the bindings
//   Object.entries(bindings).forEach(([keys, callback]) => {
//     const keyArr = keys.toLowerCase().split(" ");
//     const normalizedKeys = keyArr.sort().join(" ");
//     activeBindings.set(normalizedKeys, callback);
//   });

//   const resetKeyStates = () => {
//     for (const key in keyStates) {
//       keyStates[key] = false;
//     }
//   };

//   const handleKeyDown = (e) => {
//     const key = e.key.toLowerCase();
//     keyStates[key] = true;

//     // Get current combination of pressed keys
//     const currentCombo = Object.keys(keyStates)
//       .filter((k) => keyStates[k])
//       .sort()
//       .join(" ");

//     if (activeBindings.has(currentCombo)) {
//       e.preventDefault();
//       activeBindings.get(currentCombo)(e);
//     }
//   };

//   const handleKeyUp = (e) => {
//     const key = e.key.toLowerCase();
//     keyStates[key] = false;
//   };

//   const handleBlur = () => {
//     resetKeyStates();
//   };

//   document.addEventListener("keydown", handleKeyDown);
//   document.addEventListener("keyup", handleKeyUp);
//   window.addEventListener("blur", handleBlur);

//   // Return unsubscribe function
//   return () => {
//     document.removeEventListener("keydown", handleKeyDown);
//     document.removeEventListener("keyup", handleKeyUp);
//     window.removeEventListener("blur", handleBlur);
//     Object.keys(bindings).forEach((key) => {
//       activeBindings.delete(key.toLowerCase().split(" ").sort().join(" "));
//     });
//     resetKeyStates();
//   };
// };
</script>
  <script>(function () {
  "use strict";

  /**
   * Normalizes and validates a key string for the mouse event.
   * @param {string} key - The key string to normalize.
   * @returns {string} The normalized key string.
   * @throws {Error} If the key contains invalid modifiers or events.
   */
  function normalizeKey(key) {
    const parts = key.trim().toLowerCase().split(/\s+/);
    const modifiers = new Set();
    let eventType = null;

    for (const part of parts) {
      if (part === "command" || part === "ctrl") {
        modifiers.add("ctrl");
      } else if (part === "alt" || part === "shift") {
        modifiers.add(part);
      } else if (part === "click" || part === "rightclick") {
        if (eventType) throw new Error(`Duplicate event type: ${key}`);
        eventType = part;
      } else {
        throw new Error(`Invalid key part: ${part}`);
      }
    }

    if (!eventType) throw new Error(`Missing event type: ${key}`);

    // Sort modifiers for consistency
    const sortedModifiers = [...modifiers].sort();
    return sortedModifiers.length
      ? [...sortedModifiers, eventType].join(" ")
      : eventType;
  }

  /**
   * @typedef {Object} Point
   * @property {number} x - The x-coordinate relative to viewport center
   * @property {number} y - The y-coordinate relative to viewport center
   */

  /**
   * Main mouse event handler function
   * @param {Object} handlers - Object with event keys and handler functions
   * @returns {function()} Unsubscribe function to remove all event listeners
   * @example
   * // Handle regular clicks
   * mouse({
   *   click: (point) => console.log(`Clicked at ${point.x}, ${point.y}`)
   * });
   * @example
   * // Handle modifier combinations
   * mouse({
   *   'ctrl click': (point) => console.log('Ctrl+Click'),
   *   'ctrl alt rightclick': (point) => console.log('Ctrl+Alt+RightClick')
   * });
   */
  const mouse = (handlers) => {
    const normalizedHandlers = new Map();
    const listener = (event) => {
      const type = event.type === "contextmenu" ? "rightclick" : "click";
      const modifiers = [];

      if (event.ctrlKey || event.metaKey) modifiers.push("ctrl");
      if (event.altKey) modifiers.push("alt");
      if (event.shiftKey) modifiers.push("shift");

      const sortedModifiers = modifiers.sort();
      const key = sortedModifiers.length
        ? [...sortedModifiers, type].join(" ")
        : type;

      if (normalizedHandlers.has(key)) {
        const point = {
          x: event.clientX,
          y: event.clientY,
        };
        normalizedHandlers.get(key)(point);
      }
    };

    // Normalize all handler keys
    Object.entries(handlers).forEach(([key, handler]) => {
      normalizedHandlers.set(normalizeKey(key), handler);
    });

    // Add event listeners
    window.addEventListener("click", listener);
    window.addEventListener("contextmenu", listener);

    // Return unsubscribe function
    return () => {
      window.removeEventListener("click", listener);
      window.removeEventListener("contextmenu", listener);
      normalizedHandlers.clear();
    };
  };

  // Export to global scope
  window.mouse = mouse;
})();
</script>
  <script>const flair=({stylesheet:e,theme:t,glossary:r})=>{const{is:o,has:n,keys:l,values:a,each:i,flatten:s,map:d,generate:g,merge:p}=f,c=s(e,((e,t)=>`${e} :is(${t})`)),h={color:{none:"none",inherit:"inherit",current:"currentColor",transparent:"transparent"},size:{...g((e=>.25*e+"rem"),1,100),xs:"0.75rem",sm:"0.875rem",base:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"},weight:{thin:100,extralight:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},leading:{none:1,tight:1.25,snug:1.375,normal:1.5,relaxed:1.625,loose:2},length:{...g((e=>.25*e+"rem"),1,100),full:"100%",min:"min-content",max:"max-content",none:"none"},percentage:{...g((e=>`${e}%`),0,200)},angle:{...g((e=>`${e}deg`),0,180)},rounded:{"":"0.25rem","2xl":"0rem",sm:"0.125rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},"drop-shadow":{sm:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.05))","":"drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1)) drop-shadow(0 1px 1px rgba(0, 0, 0, 0.06))",md:"drop-shadow(0 4px 3px rgba(0, 0, 0, 0.07)) drop-shadow(0 2px 2px rgba(0, 0, 0, 0.06))",lg:"drop-shadow(0 10px 8px rgba(0, 0, 0, 0.04)) drop-shadow(0 4px 3px rgba(0, 0, 0, 0.1))",xl:"drop-shadow(0 20px 13px rgba(0, 0, 0, 0.03)) drop-shadow(0 8px 5px rgba(0, 0, 0, 0.08))","2xl":"drop-shadow(0 25px 25px rgba(0, 0, 0, 0.15))",none:"drop-shadow(0 0 #0000)"},screen:{sm:"640px",md:"768px",lg:"1024px",xl:"1280px","2xl":"1536px"}},b=d(p(h,t),(([e,t])=>[e,s(t,"-")])),m=p({display:"display",block:"display:block",inline:"display:inline",hidden:"display:none",table:"display:table","table-row":"display:table-row","table-cell":"display:table-cell",pos:"position",static:"position:static",relative:"position:relative",absolute:"position:absolute",fixed:"position:fixed",sticky:"position:sticky",top:{length:"top"},right:{length:"right"},bottom:{length:"bottom"},left:{length:"left"},inset:{length:["top","bottom","left","right"]},"inset-x":{length:["left","right"]},"inset-y":{length:["top","bottom"]},z:"z-index",w:{length:"width"},h:{length:"height"},"min-w":{length:"min-width"},"max-w":{length:"max-width"},"min-h":{length:"min-height"},"max-h":{length:"max-height"},"w-full":"width:100%","h-full":"height:100%","w-screen":"width:100vw","h-screen":"height:100vh","box-border":"box-sizing:border-box","box-content":"box-sizing:content-box",m:{length:"margin"},mt:{length:"margin-top"},mr:{length:"margin-right"},mb:{length:"margin-bottom"},ml:{length:"margin-left"},mx:{length:["margin-left","margin-right"]},my:{length:["margin-top","margin-bottom"]},p:{length:"padding"},pt:{length:"padding-top"},pr:{length:"padding-right"},pb:{length:"padding-bottom"},pl:{length:"padding-left"},px:{length:["padding-left","padding-right"]},py:{length:["padding-top","padding-bottom"]},flex:"flex","flex-row":"flex-direction:row","flex-col":"flex-direction:column","flex-wrap":"flex-wrap:wrap","flex-nowrap":"flex-wrap:nowrap","flex-1":"flex:1 1 0%","flex-auto":"flex:1 1 auto","flex-initial":"flex:0 1 auto","flex-none":"flex:none",justify:"justify-content",items:"align-items",content:"align-content",self:"align-self",grid:"display:grid","grid-cols":"grid-template-columns","grid-rows":"grid-template-rows","col-span":"grid-column","row-span":"grid-row",gap:"gap","gap-x":"column-gap","gap-y":"row-gap",overflow:{overflow:"overflow"},"overflow-x":{overflow:"overflow-x"},"overflow-y":{overflow:"overflow-y"},text:{color:"color",size:"font-size",weight:"font-weight",default:"color"},font:"font-family",style:"font-style",decoration:"text-decoration",underline:"text-decoration:underline",linethrough:"text-decoration:line-through",leading:"line-height",tracking:{size:"letter-spacing"},list:"list-style-type",truncate:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap","text-left":"text-align:left","text-center":"text-align:center","text-right":"text-align:right","text-justify":"text-align:justify",uppercase:"text-transform:uppercase",lowercase:"text-transform:lowercase",capitalize:"text-transform:capitalize","normal-case":"text-transform:none",bg:{color:"background-color"},border:{color:"border-color"},"bg-cover":"background-size:cover","bg-contain":"background-size:contain","bg-center":"background-position:center","bg-repeat":"background-repeat:repeat","bg-no-repeat":"background-repeat:no-repeat","bg-fixed":"background-attachment:fixed",border:{width:"border-width"},"border-t":{width:"border-top-width"},"border-r":{width:"border-right-width"},"border-b":{width:"border-bottom-width"},"border-l":{width:"border-left-width"},"border-x":{width:["border-left-width","border-right-width"]},"border-y":{width:["border-top-width","border-bottom-width"]},rounded:"border-radius",float:"float","float-left":"float:left","float-right":"float:right","float-none":"float:none",clear:"clear","clear-left":"clear:left","clear-right":"clear:right","clear-both":"clear:both","clear-none":"clear:none",shadow:"box-shadow",opacity:"opacity",transform:"transform",origin:"transform-origin","transform-3d":"transform-style: preserve-3d","transform-flat":"transform-style: flat",backface:"backface-visibility",rotate:{angle:"rotate"},"rotate-x":{angle:"transform.rotateX"},"rotate-y":{angle:"transform.rotateY"},"rotate-z":{angle:"transform.rotateZ"},scale:{percentage:"scale"},translate:{length:["transform.translateX","transform.translateY"]},"translate-x":{length:"transform.translateX"},"translate-y":{length:"transform.translateY"},"translate-z":{length:"transform.translateZ"},skew:{angle:["transform.skewX","transform.skewY"]},"skew-x":{angle:"transform.skewX"},"skew-y":{angle:"transform.skewY"},transition:"transition","transition-normal":"transition-behavior: normal","transition-discrete":"transition-behavior: allow-discrete",duration:"transition-duration",ease:"transition-timing-function",delay:"transition-delay",cursor:"cursor",pointer:"cursor:pointer","not-allowed":"cursor:not-allowed",visible:"visibility:visible",invisible:"visibility:hidden",filter:"filter","filter-none":"filter:none",blur:{length:"filter.blur"},brightness:{percentage:"filter.brightness"},contrast:{percentage:"filter.contrast"},grayscale:{percentage:"filter.grayscale"},"hue-rotate":{angle:"filter.hue-rotate"},invert:{percentage:"filter.invert"},saturate:{percentage:"filter.saturate"},sepia:{percentage:"filter.sepia"},"drop-shadow":"filter.drop-shadow","backdrop-filter":"backdrop-filter","backdrop-blur":{length:"backdrop-filter.blur"},"backdrop-brightness":{percentage:"backdrop-filter.brightness"},"backdrop-contrast":{percentage:"backdrop-filter.contrast"},"backdrop-grayscale":{percentage:"backdrop-filter.grayscale"},"backdrop-hue-rotate":{angle:"backdrop-filter.hue-rotate"},"backdrop-invert":{percentage:"backdrop-filter.invert"},"backdrop-opacity":{percentage:"backdrop-filter.opacity"},"backdrop-saturate":{percentage:"backdrop-filter.saturate"},"backdrop-sepia":{percentage:"backdrop-filter.sepia"},fill:{color:"fill"},stroke:{color:"stroke",length:"stroke-width",default:"length"}},r),x={};return d(c,(([e,t])=>{d(t.split(/\s+/),(t=>{const[r,s]=((e,t)=>{let r="";const o=t.split(":").slice(0,-1).sort().filter((e=>!n(b,"screen",e)||(r=`@media (min-width: ${b.screen[e]})`,!1)));return[`${r}${e}${["",...o].join(":")}`,t.split(":").at(-1)]})(e,t);n(x,r)||(x[r]={});const{prop:g,value:p}=s.endsWith("]")?(e=>{const t=e.split("["),r=t[0].endsWith("-")?t[0].slice(0,-1):t[0];let l;const i=t[1].slice(0,-1).replaceAll("_"," ");if(n(m,r)){const e=m[r];l=o(e,"string")?e:n(e,"default")?e.default:a(e)[0]}else l=r;return{prop:l,value:i}})(s):(e=>{const t=e.startsWith("-"),r=e.endsWith("!");let a,s,g=!1;const p=e.slice(t?1:0,...r?[-1]:[]).split("-");for(const e of i(p.length-1)){const t=p.slice(0,p.length-e).join("-");if(n(m,t)){a=t,s=p.slice(p.length-e).join("-"),g=!0;break}}let c,h;if(g){const e=m[a];if(o(e,"string")&&e.includes(":"))e.includes(";")?(c=[],h=[],d(e.split(";"),(e=>{const[t,r]=e.split(":");c.push(t),h.push(r)}))):[c,h]=e.split(":");else if(o(e,"string")&&!e.includes(":"))c=e,h=n(b,a,s)?b[a][s]:s;else if(o(e,"object")){let t;const r=l(e);if(1==r.length)t=r[0];else{let o=!1;for(const e of r)if(n(b,e,s)){t=e,o=!0;break}o||(t=e.default)}c=e[t],h=n(b,a,s)?b[a][s]:n(b,t,s)?b[t][s]:s}}else c=p.slice(0,p.length-1).join("-"),h=p.slice(-1)[0];return t&&(h=`-${h}`),r&&(h=`${h} !important`),{prop:c,value:h}})(s);if(o(g,"string"))x[r][g]=p;else if(o(g,"array")){const e=g;o(p,"array")?d(e,((e,t)=>{x[r][e]=p[t]})):d(e,(e=>{x[r][e]=p}))}}))})),d(x,(([e,t])=>{const r=(e=>{const t={};return d(e,(([e,r])=>{if(e.includes(".")){const[o,l]=e.split("."),a=["drop-shadow"].includes(l)?r:`${l}(${r}) `;n(t,o)||(t[o]=""),t[o]+=a}else t[e]=r})),t})(t);return`${e}{${d(r,(([e,t])=>`${e}:${t};`)).join("")}}`})).join("")};</script>
  <script>!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e||self).preact={})}(this,(function(e){var t,n,r,o,_,u,i,l,c,a=65536,f=1<<17,s={},p=[],d=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,h=Array.isArray;function v(e,t){for(var n in t)e[n]=t[n];return e}function y(e){var t=e.parentNode;t&&t.removeChild(e)}function m(e,n,r){var o,_,u,i={};for(u in n)"key"==u?o=n[u]:"ref"==u?_=n[u]:i[u]=n[u];if(arguments.length>2&&(i.children=arguments.length>3?t.call(arguments,2):r),"function"==typeof e&&null!=e.defaultProps)for(u in e.defaultProps)void 0===i[u]&&(i[u]=e.defaultProps[u]);return g(e,i,o,_,null)}function g(e,t,o,_,u){var i={type:e,props:t,key:o,ref:_,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:null==u?++r:u,__i:-1,__u:0};return null==u&&null!=n.vnode&&n.vnode(i),i}function b(e){return e.children}function C(e,t){this.props=e,this.context=t}function k(e,t){if(null==t)return e.__?k(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?k(e):null}function E(e,t,r){var o,_=e.__v,u=_.__e,i=e.__P;if(i)return(o=v({},_)).__v=_.__v+1,n.vnode&&n.vnode(o),T(i,o,_,e.__n,void 0!==i.ownerSVGElement,32&_.__u?[u]:null,t,null==u?k(_):u,!!(32&_.__u),r),o.__v=_.__v,o.__.__k[o.__i]=o,o.__d=void 0,o.__e!=u&&x(o),o}function x(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return x(e)}}function S(e){(!e.__d&&(e.__d=!0)&&_.push(e)&&!P.__r++||u!==n.debounceRendering)&&((u=n.debounceRendering)||i)(P)}function P(){var e,t,r,o=[],u=[];for(_.sort(l);e=_.shift();)e.__d&&(r=_.length,t=E(e,o,u)||t,0===r||_.length>r?(j(o,t,u),u.length=o.length=0,t=void 0,_.sort(l)):t&&n.__c&&n.__c(t,p));t&&j(o,t,u),P.__r=0}function w(e,t,n,r,o,_,u,i,l,c,f){var d,h,v,y,m,g=r&&r.__k||p,b=t.length;for(n.__d=l,N(n,t,g),l=n.__d,d=0;d<b;d++)null!=(v=n.__k[d])&&"boolean"!=typeof v&&"function"!=typeof v&&(h=-1===v.__i?s:g[v.__i]||s,v.__i=d,T(e,v,h,o,_,u,i,l,c,f),y=v.__e,v.ref&&h.ref!=v.ref&&(h.ref&&L(h.ref,null,v),f.push(v.ref,v.__c||y,v)),null==m&&null!=y&&(m=y),v.__u&a||h.__k===v.__k?l=O(v,l,e):"function"==typeof v.type&&void 0!==v.__d?l=v.__d:y&&(l=y.nextSibling),v.__d=void 0,v.__u&=-196609);n.__d=l,n.__e=m}function N(e,t,n){var r,o,_,u,i,l=t.length,c=n.length,s=c,p=0;for(e.__k=[],r=0;r<l;r++)u=r+p,null!=(o=e.__k[r]=null==(o=t[r])||"boolean"==typeof o||"function"==typeof o?null:"string"==typeof o||"number"==typeof o||"bigint"==typeof o||o.constructor==String?g(null,o,null,null,null):h(o)?g(b,{children:o},null,null,null):void 0===o.constructor&&o.__b>0?g(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o)?(o.__=e,o.__b=e.__b+1,i=A(o,n,u,s),o.__i=i,_=null,-1!==i&&(s--,(_=n[i])&&(_.__u|=f)),null==_||null===_.__v?(-1==i&&p--,"function"!=typeof o.type&&(o.__u|=a)):i!==u&&(i===u+1?p++:i>u?s>l-u?p+=i-u:p--:i<u?i==u-1&&(p=i-u):p=0,i!==r+p&&(o.__u|=a))):(_=n[u])&&null==_.key&&_.__e&&0==(_.__u&f)&&(_.__e==e.__d&&(e.__d=k(_)),V(_,_,!1),n[u]=null,s--);if(s)for(r=0;r<c;r++)null!=(_=n[r])&&0==(_.__u&f)&&(_.__e==e.__d&&(e.__d=k(_)),V(_,_))}function O(e,t,n){var r,o;if("function"==typeof e.type){for(r=e.__k,o=0;r&&o<r.length;o++)r[o]&&(r[o].__=e,t=O(r[o],t,n));return t}e.__e!=t&&(n.insertBefore(e.__e,t||null),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8===t.nodeType);return t}function A(e,t,n,r){var o=e.key,_=e.type,u=n-1,i=n+1,l=t[n];if(null===l||l&&o==l.key&&_===l.type&&0==(l.__u&f))return n;if(r>(null!=l&&0==(l.__u&f)?1:0))for(;u>=0||i<t.length;){if(u>=0){if((l=t[u])&&0==(l.__u&f)&&o==l.key&&_===l.type)return u;u--}if(i<t.length){if((l=t[i])&&0==(l.__u&f)&&o==l.key&&_===l.type)return i;i++}}return-1}function R(e,t,n){"-"===t[0]?e.setProperty(t,null==n?"":n):e[t]=null==n?"":"number"!=typeof n||d.test(t)?n:n+"px"}function H(e,t,n,r,o){var _;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof r&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||R(e.style,t,"");if(n)for(t in n)r&&n[t]===r[t]||R(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])_=t!==(t=t.replace(/(PointerCapture)$|Capture$/i,"$1")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+_]=n,n?r?n.u=r.u:(n.u=Date.now(),e.addEventListener(t,_?U:D,_)):e.removeEventListener(t,_?U:D,_);else{if(o)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!==t&&"height"!==t&&"href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&"rowSpan"!==t&&"colSpan"!==t&&"role"!==t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null==n||!1===n&&"-"!==t[4]?e.removeAttribute(t):e.setAttribute(t,n))}}function D(e){if(this.l){var t=this.l[e.type+!1];if(e.t){if(e.t<=t.u)return}else e.t=Date.now();return t(n.event?n.event(e):e)}}function U(e){if(this.l)return this.l[e.type+!0](n.event?n.event(e):e)}function T(e,t,r,o,_,u,i,l,c,a){var f,s,p,d,y,m,g,k,E,x,S,P,N,O,A,R=t.type;if(void 0!==t.constructor)return null;128&r.__u&&(c=!!(32&r.__u),u=[l=t.__e=r.__e]),(f=n.__b)&&f(t);e:if("function"==typeof R)try{if(k=t.props,E=(f=R.contextType)&&o[f.__c],x=f?E?E.props.value:f.__:o,r.__c?g=(s=t.__c=r.__c).__=s.__E:("prototype"in R&&R.prototype.render?t.__c=s=new R(k,x):(t.__c=s=new C(k,x),s.constructor=R,s.render=W),E&&E.sub(s),s.props=k,s.state||(s.state={}),s.context=x,s.__n=o,p=s.__d=!0,s.__h=[],s._sb=[]),null==s.__s&&(s.__s=s.state),null!=R.getDerivedStateFromProps&&(s.__s==s.state&&(s.__s=v({},s.__s)),v(s.__s,R.getDerivedStateFromProps(k,s.__s))),d=s.props,y=s.state,s.__v=t,p)null==R.getDerivedStateFromProps&&null!=s.componentWillMount&&s.componentWillMount(),null!=s.componentDidMount&&s.__h.push(s.componentDidMount);else{if(null==R.getDerivedStateFromProps&&k!==d&&null!=s.componentWillReceiveProps&&s.componentWillReceiveProps(k,x),!s.__e&&(null!=s.shouldComponentUpdate&&!1===s.shouldComponentUpdate(k,s.__s,x)||t.__v===r.__v)){for(t.__v!==r.__v&&(s.props=k,s.state=s.__s,s.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.forEach((function(e){e&&(e.__=t)})),S=0;S<s._sb.length;S++)s.__h.push(s._sb[S]);s._sb=[],s.__h.length&&i.push(s);break e}null!=s.componentWillUpdate&&s.componentWillUpdate(k,s.__s,x),null!=s.componentDidUpdate&&s.__h.push((function(){s.componentDidUpdate(d,y,m)}))}if(s.context=x,s.props=k,s.__P=e,s.__e=!1,P=n.__r,N=0,"prototype"in R&&R.prototype.render){for(s.state=s.__s,s.__d=!1,P&&P(t),f=s.render(s.props,s.state,s.context),O=0;O<s._sb.length;O++)s.__h.push(s._sb[O]);s._sb=[]}else do{s.__d=!1,P&&P(t),f=s.render(s.props,s.state,s.context),s.state=s.__s}while(s.__d&&++N<25);s.state=s.__s,null!=s.getChildContext&&(o=v(v({},o),s.getChildContext())),p||null==s.getSnapshotBeforeUpdate||(m=s.getSnapshotBeforeUpdate(d,y)),w(e,h(A=null!=f&&f.type===b&&null==f.key?f.props.children:f)?A:[A],t,r,o,_,u,i,l,c,a),s.base=t.__e,t.__u&=-161,s.__h.length&&i.push(s),g&&(s.__E=s.__=null)}catch(e){t.__v=null,c||null!=u?(t.__e=l,t.__u|=c?160:32,u[u.indexOf(l)]=null):(t.__e=r.__e,t.__k=r.__k),n.__e(e,t,r)}else null==u&&t.__v===r.__v?(t.__k=r.__k,t.__e=r.__e):t.__e=F(r.__e,t,r,o,_,u,i,c,a);(f=n.diffed)&&f(t)}function j(e,t,r){for(var o=0;o<r.length;o++)L(r[o],r[++o],r[++o]);n.__c&&n.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){n.__e(e,t.__v)}}))}function F(e,n,r,o,_,u,i,l,c){var a,f,p,d,v,m,g,b=r.props,C=n.props,E=n.type;if("svg"===E&&(_=!0),null!=u)for(a=0;a<u.length;a++)if((v=u[a])&&"setAttribute"in v==!!E&&(E?v.localName===E:3===v.nodeType)){e=v,u[a]=null;break}if(null==e){if(null===E)return document.createTextNode(C);e=_?document.createElementNS("http://www.w3.org/2000/svg",E):document.createElement(E,C.is&&C),u=null,l=!1}if(null===E)b===C||l&&e.data===C||(e.data=C);else{if(u=u&&t.call(e.childNodes),b=r.props||s,!l&&null!=u)for(b={},a=0;a<e.attributes.length;a++)b[(v=e.attributes[a]).name]=v.value;for(a in b)v=b[a],"children"==a||("dangerouslySetInnerHTML"==a?p=v:"key"===a||a in C||H(e,a,null,v,_));for(a in C)v=C[a],"children"==a?d=v:"dangerouslySetInnerHTML"==a?f=v:"value"==a?m=v:"checked"==a?g=v:"key"===a||l&&"function"!=typeof v||b[a]===v||H(e,a,v,b[a],_);if(f)l||p&&(f.__html===p.__html||f.__html===e.innerHTML)||(e.innerHTML=f.__html),n.__k=[];else if(p&&(e.innerHTML=""),w(e,h(d)?d:[d],n,r,o,_&&"foreignObject"!==E,u,i,u?u[0]:r.__k&&k(r,0),l,c),null!=u)for(a=u.length;a--;)null!=u[a]&&y(u[a]);l||(a="value",void 0!==m&&(m!==e[a]||"progress"===E&&!m||"option"===E&&m!==b[a])&&H(e,a,m,b[a],!1),a="checked",void 0!==g&&g!==e[a]&&H(e,a,g,b[a],!1))}return e}function L(e,t,r){try{"function"==typeof e?e(t):e.current=t}catch(e){n.__e(e,r)}}function V(e,t,r){var o,_;if(n.unmount&&n.unmount(e),(o=e.ref)&&(o.current&&o.current!==e.__e||L(o,null,t)),null!=(o=e.__c)){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(e){n.__e(e,t)}o.base=o.__P=null,e.__c=void 0}if(o=e.__k)for(_=0;_<o.length;_++)o[_]&&V(o[_],t,r||"function"!=typeof e.type);r||null==e.__e||y(e.__e),e.__=e.__e=e.__d=void 0}function W(e,t,n){return this.constructor(e,n)}function I(e,r,o){var _,u,i,l;n.__&&n.__(e,r),u=(_="function"==typeof o)?null:o&&o.__k||r.__k,i=[],l=[],T(r,e=(!_&&o||r).__k=m(b,null,[e]),u||s,s,void 0!==r.ownerSVGElement,!_&&o?[o]:u?null:r.firstChild?t.call(r.childNodes):null,i,!_&&o?o:u?u.__e:r.firstChild,_,l),e.__d=void 0,j(i,e,l)}t=p.slice,n={__e:function(e,t,n,r){for(var o,_,u;t=t.__;)if((o=t.__c)&&!o.__)try{if((_=o.constructor)&&null!=_.getDerivedStateFromError&&(o.setState(_.getDerivedStateFromError(e)),u=o.__d),null!=o.componentDidCatch&&(o.componentDidCatch(e,r||{}),u=o.__d),u)return o.__E=o}catch(t){e=t}throw e}},r=0,o=function(e){return null!=e&&null==e.constructor},C.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=v({},this.state),"function"==typeof e&&(e=e(v({},n),this.props)),e&&v(n,e),null!=e&&this.__v&&(t&&this._sb.push(t),S(this))},C.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),S(this))},C.prototype.render=b,_=[],i="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,l=function(e,t){return e.__v.__b-t.__v.__b},P.__r=0,c=0,e.Component=C,e.Fragment=b,e.cloneElement=function(e,n,r){var o,_,u,i,l=v({},e.props);for(u in e.type&&e.type.defaultProps&&(i=e.type.defaultProps),n)"key"==u?o=n[u]:"ref"==u?_=n[u]:l[u]=void 0===n[u]&&void 0!==i?i[u]:n[u];return arguments.length>2&&(l.children=arguments.length>3?t.call(arguments,2):r),g(e.type,l,o||e.key,_||e.ref,null)},e.createContext=function(e,t){var n={__c:t="__cC"+c++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var n,r;return this.getChildContext||(n=[],(r={})[t]=this,this.getChildContext=function(){return r},this.shouldComponentUpdate=function(e){this.props.value!==e.value&&n.some((function(e){e.__e=!0,S(e)}))},this.sub=function(e){n.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){n.splice(n.indexOf(e),1),t&&t.call(e)}}),e.children}};return n.Provider.__=n.Consumer.contextType=n},e.createElement=m,e.createRef=function(){return{current:null}},e.h=m,e.hydrate=function e(t,n){I(t,n,e)},e.isValidElement=o,e.options=n,e.render=I,e.toChildArray=function e(t,n){return n=n||[],null==t||"boolean"==typeof t||(h(t)?t.some((function(t){e(t,n)})):n.push(t)),n}})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("preact")):"function"==typeof define&&define.amd?define(["exports","preact"],t):t((e||self).preactHooks={},e.preact)}(this,(function(e,t){var n,r,o,_,u=0,i=[],l=[],c=t.options,a=c.__b,f=c.__r,s=c.diffed,p=c.__c,d=c.unmount,h=c.__;function v(e,t){c.__h&&c.__h(r,e,u||t),u=0;var n=r.__H||(r.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({__V:l}),n.__[e]}function y(e){return u=1,m(w,e)}function m(e,t,o){var _=v(n++,2);if(_.t=e,!_.__c&&(_.__=[o?o(t):w(void 0,t),function(e){var t=_.__N?_.__N[0]:_.__[0],n=_.t(t,e);t!==n&&(_.__N=[n,_.__[1]],_.__c.setState({}))}],_.__c=r,!r.u)){var u=function(e,t,n){if(!_.__c.__H)return!0;var r=_.__c.__H.__.filter((function(e){return!!e.__c}));if(r.every((function(e){return!e.__N})))return!i||i.call(this,e,t,n);var o=!1;return r.forEach((function(e){if(e.__N){var t=e.__[0];e.__=e.__N,e.__N=void 0,t!==e.__[0]&&(o=!0)}})),!(!o&&_.__c.props===e)&&(!i||i.call(this,e,t,n))};r.u=!0;var i=r.shouldComponentUpdate,l=r.componentWillUpdate;r.componentWillUpdate=function(e,t,n){if(this.__e){var r=i;i=void 0,u(e,t,n),i=r}l&&l.call(this,e,t,n)},r.shouldComponentUpdate=u}return _.__N||_.__}function g(e,t){var o=v(n++,4);!c.__s&&P(o.__H,t)&&(o.__=e,o.i=t,r.__h.push(o))}function b(e,t){var r=v(n++,7);return P(r.__H,t)?(r.__V=e(),r.i=t,r.__h=e,r.__V):r.__}function C(){for(var e;e=i.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(x),e.__H.__h.forEach(S),e.__H.__h=[]}catch(t){e.__H.__h=[],c.__e(t,e.__v)}}c.__b=function(e){r=null,a&&a(e)},c.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),h&&h(e,t)},c.__r=function(e){f&&f(e),n=0;var t=(r=e.__c).__H;t&&(o===r?(t.__h=[],r.__h=[],t.__.forEach((function(e){e.__N&&(e.__=e.__N),e.__V=l,e.__N=e.i=void 0}))):(t.__h.forEach(x),t.__h.forEach(S),t.__h=[],n=0)),o=r},c.diffed=function(e){s&&s(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(1!==i.push(t)&&_===c.requestAnimationFrame||((_=c.requestAnimationFrame)||E)(C)),t.__H.__.forEach((function(e){e.i&&(e.__H=e.i),e.__V!==l&&(e.__=e.__V),e.i=void 0,e.__V=l}))),o=r=null},c.__c=function(e,t){t.some((function(e){try{e.__h.forEach(x),e.__h=e.__h.filter((function(e){return!e.__||S(e)}))}catch(n){t.some((function(e){e.__h&&(e.__h=[])})),t=[],c.__e(n,e.__v)}})),p&&p(e,t)},c.unmount=function(e){d&&d(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach((function(e){try{x(e)}catch(e){t=e}})),n.__H=void 0,t&&c.__e(t,n.__v))};var k="function"==typeof requestAnimationFrame;function E(e){var t,n=function(){clearTimeout(r),k&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,100);k&&(t=requestAnimationFrame(n))}function x(e){var t=r,n=e.__c;"function"==typeof n&&(e.__c=void 0,n()),r=t}function S(e){var t=r;e.__c=e.__(),r=t}function P(e,t){return!e||e.length!==t.length||t.some((function(t,n){return t!==e[n]}))}function w(e,t){return"function"==typeof t?t(e):t}e.useCallback=function(e,t){return u=8,b((function(){return e}),t)},e.useContext=function(e){var t=r.context[e.__c],o=v(n++,9);return o.c=e,t?(null==o.__&&(o.__=!0,t.sub(r)),t.props.value):e.__},e.useDebugValue=function(e,t){c.useDebugValue&&c.useDebugValue(t?t(e):e)},e.useEffect=function(e,t){var o=v(n++,3);!c.__s&&P(o.__H,t)&&(o.__=e,o.i=t,r.__H.__h.push(o))},e.useErrorBoundary=function(e){var t=v(n++,10),o=y();return t.__=e,r.componentDidCatch||(r.componentDidCatch=function(e,n){t.__&&t.__(e,n),o[1](e)}),[o[0],function(){o[1](void 0)}]},e.useId=function(){var e=v(n++,11);if(!e.__){for(var t=r.__v;null!==t&&!t.__m&&null!==t.__;)t=t.__;var o=t.__m||(t.__m=[0,0]);e.__="P"+o[0]+"-"+o[1]++}return e.__},e.useImperativeHandle=function(e,t,n){u=6,g((function(){return"function"==typeof e?(e(t()),function(){return e(null)}):e?(e.current=t(),function(){return e.current=null}):void 0}),null==n?n:n.concat(e))},e.useLayoutEffect=g,e.useMemo=b,e.useReducer=m,e.useRef=function(e){return u=5,b((function(){return{current:e}}),[])},e.useState=y})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("preact"),require("preact/hooks")):"function"==typeof define&&define.amd?define(["exports","preact","preact/hooks"],t):t((e||self).preactCompat={},e.preact,e.preactHooks)}(this,(function(e,t,n){function r(e,t){for(var n in t)e[n]=t[n];return e}function o(e,t){for(var n in e)if("__source"!==n&&!(n in t))return!0;for(var r in t)if("__source"!==r&&e[r]!==t[r])return!0;return!1}function _(e,t){this.props=e,this.context=t}function u(e,n){function r(e){var t=this.props.ref,r=t==e.ref;return!r&&t&&(t.call?t(null):t.current=null),n?!n(this.props,e)||!r:o(this.props,e)}function _(n){return this.shouldComponentUpdate=r,t.createElement(e,n)}return _.displayName="Memo("+(e.displayName||e.name)+")",_.prototype.isReactComponent=!0,_.__f=!0,_}(_.prototype=new t.Component).isPureReactComponent=!0,_.prototype.shouldComponentUpdate=function(e,t){return o(this.props,e)||o(this.state,t)};var i=t.options.__b;t.options.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),i&&i(e)};var l="undefined"!=typeof Symbol&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function c(e){function t(t){var n=r({},t);return delete n.ref,e(n,t.ref||null)}return t.$$typeof=l,t.render=t,t.prototype.isReactComponent=t.__f=!0,t.displayName="ForwardRef("+(e.displayName||e.name)+")",t}var a=function(e,n){return null==e?null:t.toChildArray(t.toChildArray(e).map(n))},f={map:a,forEach:a,count:function(e){return e?t.toChildArray(e).length:0},only:function(e){var n=t.toChildArray(e);if(1!==n.length)throw"Children.only";return n[0]},toArray:t.toChildArray},s=t.options.__e;t.options.__e=function(e,t,n,r){if(e.then)for(var o,_=t;_=_.__;)if((o=_.__c)&&o.__c)return null==t.__e&&(t.__e=n.__e,t.__k=n.__k),o.__c(e,t);s(e,t,n,r)};var p=t.options.unmount;function d(e,t,n){return e&&(e.__c&&e.__c.__H&&(e.__c.__H.__.forEach((function(e){"function"==typeof e.__c&&e.__c()})),e.__c.__H=null),null!=(e=r({},e)).__c&&(e.__c.__P===n&&(e.__c.__P=t),e.__c=null),e.__k=e.__k&&e.__k.map((function(e){return d(e,t,n)}))),e}function h(e,t,n){return e&&n&&(e.__v=null,e.__k=e.__k&&e.__k.map((function(e){return h(e,t,n)})),e.__c&&e.__c.__P===t&&(e.__e&&n.appendChild(e.__e),e.__c.__e=!0,e.__c.__P=n)),e}function v(){this.__u=0,this.t=null,this.__b=null}function y(e){var t=e.__.__c;return t&&t.__a&&t.__a(e)}function m(e){var n,r,o;function _(_){if(n||(n=e()).then((function(e){r=e.default||e}),(function(e){o=e})),o)throw o;if(!r)throw n;return t.createElement(r,_)}return _.displayName="Lazy",_.__f=!0,_}function g(){this.u=null,this.o=null}t.options.unmount=function(e){var t=e.__c;t&&t.__R&&t.__R(),t&&32&e.__u&&(e.type=null),p&&p(e)},(v.prototype=new t.Component).__c=function(e,t){var n=t.__c,r=this;null==r.t&&(r.t=[]),r.t.push(n);var o=y(r.__v),_=!1,u=function(){_||(_=!0,n.__R=null,o?o(i):i())};n.__R=u;var i=function(){if(! --r.__u){if(r.state.__a){var e=r.state.__a;r.__v.__k[0]=h(e,e.__c.__P,e.__c.__O)}var t;for(r.setState({__a:r.__b=null});t=r.t.pop();)t.forceUpdate()}};r.__u++||32&t.__u||r.setState({__a:r.__b=r.__v.__k[0]}),e.then(u,u)},v.prototype.componentWillUnmount=function(){this.t=[]},v.prototype.render=function(e,n){if(this.__b){if(this.__v.__k){var r=document.createElement("div"),o=this.__v.__k[0].__c;this.__v.__k[0]=d(this.__b,r,o.__O=o.__P)}this.__b=null}var _=n.__a&&t.createElement(t.Fragment,null,e.fallback);return _&&(_.__u&=-33),[t.createElement(t.Fragment,null,n.__a?null:e.children),_]};var b=function(e,t,n){if(++n[1]===n[0]&&e.o.delete(t),e.props.revealOrder&&("t"!==e.props.revealOrder[0]||!e.o.size))for(n=e.u;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;e.u=n=n[2]}};function C(e){return this.getChildContext=function(){return e.context},e.children}function k(e){var n=this,r=e.i;n.componentWillUnmount=function(){t.render(null,n.l),n.l=null,n.i=null},n.i&&n.i!==r&&n.componentWillUnmount(),n.l||(n.i=r,n.l={nodeType:1,parentNode:r,childNodes:[],appendChild:function(e){this.childNodes.push(e),n.i.appendChild(e)},insertBefore:function(e,t){this.childNodes.push(e),n.i.appendChild(e)},removeChild:function(e){this.childNodes.splice(this.childNodes.indexOf(e)>>>1,1),n.i.removeChild(e)}}),t.render(t.createElement(C,{context:n.context},e.__v),n.l)}function E(e,n){var r=t.createElement(k,{__v:e,i:n});return r.containerInfo=n,r}(g.prototype=new t.Component).__a=function(e){var t=this,n=y(t.__v),r=t.o.get(e);return r[0]++,function(o){var _=function(){t.props.revealOrder?(r.push(o),b(t,e,r)):o()};n?n(_):_()}},g.prototype.render=function(e){this.u=null,this.o=new Map;var n=t.toChildArray(e.children);e.revealOrder&&"b"===e.revealOrder[0]&&n.reverse();for(var r=n.length;r--;)this.o.set(n[r],this.u=[1,0,this.u]);return e.children},g.prototype.componentDidUpdate=g.prototype.componentDidMount=function(){var e=this;this.o.forEach((function(t,n){b(e,n,t)}))};var x="undefined"!=typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,S=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,P=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,w=/[A-Z0-9]/g,N="undefined"!=typeof document,O=function(e){return("undefined"!=typeof Symbol&&"symbol"==typeof Symbol()?/fil|che|rad/:/fil|che|ra/).test(e)};function A(e,n,r){return null==n.__k&&(n.textContent=""),t.render(e,n),"function"==typeof r&&r(),e?e.__c:null}function R(e,n,r){return t.hydrate(e,n),"function"==typeof r&&r(),e?e.__c:null}t.Component.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach((function(e){Object.defineProperty(t.Component.prototype,e,{configurable:!0,get:function(){return this["UNSAFE_"+e]},set:function(t){Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t})}})}));var H=t.options.event;function D(){}function U(){return this.cancelBubble}function T(){return this.defaultPrevented}t.options.event=function(e){return H&&(e=H(e)),e.persist=D,e.isPropagationStopped=U,e.isDefaultPrevented=T,e.nativeEvent=e};var j,F={enumerable:!1,configurable:!0,get:function(){return this.class}},L=t.options.vnode;t.options.vnode=function(e){"string"==typeof e.type&&function(e){var n=e.props,r=e.type,o={};for(var _ in n){var u=n[_];if(!("value"===_&&"defaultValue"in n&&null==u||N&&"children"===_&&"noscript"===r||"class"===_||"className"===_)){var i=_.toLowerCase();"defaultValue"===_&&"value"in n&&null==n.value?_="value":"download"===_&&!0===u?u="":"translate"===i&&"no"===u?u=!1:"ondoubleclick"===i?_="ondblclick":"onchange"!==i||"input"!==r&&"textarea"!==r||O(n.type)?"onfocus"===i?_="onfocusin":"onblur"===i?_="onfocusout":P.test(_)?_=i:-1===r.indexOf("-")&&S.test(_)?_=_.replace(w,"-$&").toLowerCase():null===u&&(u=void 0):i=_="oninput","oninput"===i&&o[_=i]&&(_="oninputCapture"),o[_]=u}}"select"==r&&o.multiple&&Array.isArray(o.value)&&(o.value=t.toChildArray(n.children).forEach((function(e){e.props.selected=-1!=o.value.indexOf(e.props.value)}))),"select"==r&&null!=o.defaultValue&&(o.value=t.toChildArray(n.children).forEach((function(e){e.props.selected=o.multiple?-1!=o.defaultValue.indexOf(e.props.value):o.defaultValue==e.props.value}))),n.class&&!n.className?(o.class=n.class,Object.defineProperty(o,"className",F)):(n.className&&!n.class||n.class&&n.className)&&(o.class=o.className=n.className),e.props=o}(e),e.$$typeof=x,L&&L(e)};var V=t.options.__r;t.options.__r=function(e){V&&V(e),j=e.__c};var W=t.options.diffed;t.options.diffed=function(e){W&&W(e);var t=e.props,n=e.__e;null!=n&&"textarea"===e.type&&"value"in t&&t.value!==n.value&&(n.value=null==t.value?"":t.value),j=null};var I={ReactCurrentDispatcher:{current:{readContext:function(e){return j.__n[e.__c].props.value}}}},M="17.0.2";function $(e){return t.createElement.bind(null,e)}function B(e){return!!e&&e.$$typeof===x}function q(e){return B(e)&&e.type===t.Fragment}function z(e){return B(e)?t.cloneElement.apply(null,arguments):e}function G(e){return!!e.__k&&(t.render(null,e),!0)}function Y(e){return e&&(e.base||1===e.nodeType&&e)||null}var Z=function(e,t){return e(t)},J=function(e,t){return e(t)},K=t.Fragment;function Q(e){e()}function X(e){return e}function ee(){return[!1,Q]}var te=n.useLayoutEffect,ne=B;function re(e,t){var r=t(),o=n.useState({h:{__:r,v:t}}),_=o[0].h,u=o[1];return n.useLayoutEffect((function(){_.__=r,_.v=t,oe(_)&&u({h:_})}),[e,r,t]),n.useEffect((function(){return oe(_)&&u({h:_}),e((function(){oe(_)&&u({h:_})}))}),[e]),r}function oe(e){var t,n,r=e.v,o=e.__;try{var _=r();return!((t=o)===(n=_)&&(0!==t||1/t==1/n)||t!=t&&n!=n)}catch(e){return!0}}var _e={useState:n.useState,useId:n.useId,useReducer:n.useReducer,useEffect:n.useEffect,useLayoutEffect:n.useLayoutEffect,useInsertionEffect:te,useTransition:ee,useDeferredValue:X,useSyncExternalStore:re,startTransition:Q,useRef:n.useRef,useImperativeHandle:n.useImperativeHandle,useMemo:n.useMemo,useCallback:n.useCallback,useContext:n.useContext,useDebugValue:n.useDebugValue,version:M,Children:f,render:A,hydrate:R,unmountComponentAtNode:G,createPortal:E,createElement:t.createElement,createContext:t.createContext,createFactory:$,cloneElement:z,createRef:t.createRef,Fragment:t.Fragment,isValidElement:B,isElement:ne,isFragment:q,findDOMNode:Y,Component:t.Component,PureComponent:_,memo:u,forwardRef:c,flushSync:J,unstable_batchedUpdates:Z,StrictMode:K,Suspense:v,SuspenseList:g,lazy:m,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:I};Object.defineProperty(e,"Component",{enumerable:!0,get:function(){return t.Component}}),Object.defineProperty(e,"Fragment",{enumerable:!0,get:function(){return t.Fragment}}),Object.defineProperty(e,"createContext",{enumerable:!0,get:function(){return t.createContext}}),Object.defineProperty(e,"createElement",{enumerable:!0,get:function(){return t.createElement}}),Object.defineProperty(e,"createRef",{enumerable:!0,get:function(){return t.createRef}}),e.Children=f,e.PureComponent=_,e.StrictMode=K,e.Suspense=v,e.SuspenseList=g,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I,e.cloneElement=z,e.createFactory=$,e.createPortal=E,e.default=_e,e.findDOMNode=Y,e.flushSync=J,e.forwardRef=c,e.hydrate=R,e.isElement=ne,e.isFragment=q,e.isValidElement=B,e.lazy=m,e.memo=u,e.render=A,e.startTransition=Q,e.unmountComponentAtNode=G,e.unstable_batchedUpdates=Z,e.useDeferredValue=X,e.useInsertionEffect=te,e.useSyncExternalStore=re,e.useTransition=ee,e.version=M,Object.keys(n).forEach((function(t){"default"===t||e.hasOwnProperty(t)||Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})}))}));const preact={...window.preact,...window.preactHooks,...window.preactCompat};let voyage={h(...e){const{createElement:t,Fragment:n,memo:r}=preact;let o="",_={},u=[];for(const[r,i]of e.entries()){const e=typeof i;"string"!=e&&"function"!=e||0!=r?"object"!=e||Array.isArray(i)?"object"==e&&Array.isArray(i)?u.push(t(n,{},...i)):"function"==e?u.push(t((()=>i()))):u.push(i):i.constructor?_=i:u.push(i):o=i}""==o?o=n:"function"==typeof o&&(o=r(o));const i=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l=e=>{if(!e||"object"!=typeof e)return e;const t={};for(const n in e){t[n.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()))]=e[n]}return t};function c(e){return e?"string"==typeof e?e:Array.isArray(e)?e.filter(Boolean).join(" "):"object"==typeof e?Object.entries(e).filter((([e,t])=>t)).map((([e])=>e)).join(" "):"":""}for(const[e,t]of Object.entries(_)){if(e.startsWith("@")){const t=`on${e.slice(1,2).toUpperCase()}${e.slice(2)}`;_[t]=_[e],delete _[e];continue}if("ref"==e){i(t,"mutate")&&(_[e]=e=>{t.mutate(e)});continue}const n="function"==typeof t?t():t,r={html(){_.dangerouslySetInnerHTML={__html:n}},bind(){_.value=t(),_.onChange=e=>t(e.target.value)},show(){_.__originalDisplay||(_.ref=e=>{e&&!_.__originalDisplay&&(_.__originalDisplay=window.getComputedStyle(e).display)}),_.style={..._.style,display:n?_.__originalDisplay||"block":"none"}}};i(r,e)?(r[e](),delete _[e]):"style"==e?_.style=l(n):"class"!=e&&"className"!=e||(_.className=c(n),"class"==e&&delete _.class)}return t(o,_,...u)},p(e){const{useRef:t,useReducer:n}=preact,r=n((()=>({})),{})[1],o=e=>{if(null===e||"object"!=typeof e)return e;if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++)t[n]=o(e[n]);return t}const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=o(e[n]));return t},_=(e,t)=>{if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||e[r]!==t[r])return!1;return!0},u=(e,t,n)=>{const r=Array.isArray(e)?[...e]:{...e};if(0===t.length)return n;let o=r;for(let e=0;e<t.length-1;e++){const n=t[e];o[n]=Array.isArray(o[n])?[...o[n]]:{...o[n]},o=o[n]}return o[t[t.length-1]]=n,r},i=t(),l=t(!0);l.current&&(i.current="function"==typeof e?e():e,l.current=!1);const c=(...e)=>{if(0==e.length);else if(1==e.length){const t="function"==typeof e[0]?e[0](i.current):e[0];i.current!==t&&(i.current=t,r())}else if(e.length>=2){const t=e.slice(0,-1),n=e[e.length-1],o=t.reduce(((e,t)=>e?.[t]),i.current),l="function"==typeof n?n(o):n;_(o,l)||(i.current=u(i.current,t,l),r())}return i.current};return c.mutate=e=>{i.current=e},c.produce=e=>{const t=o(i.current);return e(t),_(t,i.current)||(i.current=t,r()),i.current},c.reconcile=(...e)=>{const t="object"==typeof e[e.length-1]?e.pop():{},n=e.slice(0,-1),o=e[e.length-1],l=n.reduce(((e,t)=>e?.[t]),i.current);if(!l)return i.current;let c;if(t.key){const e=l?[...l]:[],n=o[t.key];if(void 0!==n){const r=e.findIndex((e=>e[t.key]==n));r>=0?(c=[...e],c[r]={...e[r],...o}):c=[...e,o]}}else c={...l,...o};return c&&!_(l,c)&&(i.current=u(i.current,n,c),r()),i.current},c},e(e,t=[]){const{useEffect:n}=preact;n(e,t.map((e=>"function"==typeof e?e():e)))},r(e,t,n){const{render:r,createElement:o}=preact;"function"==typeof e&&(e=o(e)),r(e,t,n)}};</script>
  
  <script>// todo: history. vector

// how to create segment, polygon, curve, eclipse(circle) in svg

// fit eclipse

// create control points

// mouse library

const version = "1.0";

const { h, p, e, r } = voyage;

const stylesheet = {
  ".page": `pos-fixed inset-0 max-w-full box-border m-0 overflow-hidden
  bg-gray-900`,
  "*": "fill-none stroke-5px stroke-gray-50",
  ".point": "fill-gray-50 stroke-none",
  // todo: use a color in palette instead of lightblue
  ".point.selected": "fill-lightblue stroke-none",
};

const theme = {
  color: {
    gray: {
      50: "#f6f7f9",
      800: "#343a46",
      900: "#23272f",
    },
  },
};

/**
 * Generates an SVG path string from an array of points.
 * @param {Object[]} points - Array of point objects.
 * @param {number} points[].x - The x-coordinate of the point.
 * @param {number} points[].y - The y-coordinate of the point.
 * @returns {string} SVG path string connecting the points with line segments.
 * @example
 * // Returns "M10,20 L30,40 L50,60"
 * pointsToSvgPath([{ x: 10, y: 20 }, { x: 30, y: 40 }, { x: 50, y: 60 }])
 * @example
 * // Returns "M0,0 L100,0 L100,100 L0,100 Z" (closed rectangle)
 * pointsToSvgPath([{ x: 0, y: 0 }, { x: 100, y: 0 }, { x: 100, y: 100 }, { x: 0, y: 100 }, { x: 0, y: 0 }])
 */
const line = (points) => {
  if (!points.length) return "";

  const [first, ...rest] = points;
  let path = `M${first.x},${first.y}`;

  rest.forEach((point) => {
    path += ` L${point.x},${point.y}`;
  });

  return path;
};

/**
 * Converts an array of points into a smooth SVG path string using cubic Bezier curves.
 * Control points are automatically calculated to create smooth curves between points.
 * @param {Object[]} points - Array of point objects with x and y properties.
 * @returns {string} SVG path string.
 * @example
 * // Returns "M 10 10 C 10 10, 10 10, 20 20 C 23.33 23.33, 26.67 16.67, 30 20"
 * pointsToSvgPath([
 *   { x: 10, y: 10 },
 *   { x: 20, y: 20 },
 *   { x: 30, y: 20 }
 * ]);
 */
const curve = (points) => {
  if (points.length === 0) return "";
  if (points.length === 1) return `M ${points[0].x} ${points[0].y}`;

  const path = [];
  path.push(`M ${points[0].x} ${points[0].y}`);

  for (let i = 0; i < points.length - 1; i++) {
    const p0 = points[i - 1] || points[i];
    const p1 = points[i];
    const p2 = points[i + 1];
    const p3 = points[i + 2] || p2;

    const cp1x = p1.x + (p2.x - p0.x) / 6;
    const cp1y = p1.y + (p2.y - p0.y) / 6;
    const cp2x = p2.x - (p3.x - p1.x) / 6;
    const cp2y = p2.y - (p3.y - p1.y) / 6;

    path.push(`C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${p2.x} ${p2.y}`);
  }

  return path.join(" ");
};

/**
 * Fits an ellipse to an array of points.
 * @param {Array<{x: number, y: number}>} points - The array of points to fit.
 * @returns {false | {o: {x: number, y: number}, rx: number, ry: number, rotate: number}} The fitted ellipse or false if invalid.
 * @example
 * // Single point
 * fitToEllipse([{x: 0, y: 0}]); // {o: {x: 0, y: 0}, rx: 1, ry: 1, rotate: 0}
 * // Two points
 * fitToEllipse([{x: 0, y: 0}, {x: 2, y: 0}]); // {o: {x: 1, y: 0}, rx: 1, ry: 1, rotate: 0}
 * // Three points
 * fitToEllipse([{x: 0, y: 0}, {x: 2, y: 0}, {x: 1, y: 1}]);
 */
const ellipse = (points) => {
  if (!Array.isArray(points)) return false;
  const n = points.length;
  if (n === 0) return false;
  for (let i = 0; i < n; i++) {
    const p = points[i];
    if (
      typeof p.x !== "number" ||
      typeof p.y !== "number" ||
      isNaN(p.x) ||
      isNaN(p.y)
    ) {
      return false;
    }
  }

  if (n === 1) {
    return {
      o: { x: points[0].x, y: points[0].y },
      rx: 1,
      ry: 1,
      rotate: 0,
    };
  }

  if (n === 2) {
    const p1 = points[0];
    const p2 = points[1];
    const dx = p2.x - p1.x;
    const dy = p2.y - p1.y;
    const distance = Math.sqrt(dx * dx + dy * dy);
    const radius = distance / 2;
    const center = {
      x: (p1.x + p2.x) / 2,
      y: (p1.y + p2.y) / 2,
    };
    return {
      o: center,
      rx: radius,
      ry: radius,
      rotate: 0,
    };
  }

  let sumX = 0;
  let sumY = 0;
  for (const p of points) {
    sumX += p.x;
    sumY += p.y;
  }
  const center = {
    x: sumX / n,
    y: sumY / n,
  };

  const centeredPoints = points.map((p) => ({
    x: p.x - center.x,
    y: p.y - center.y,
  }));

  let covXX = 0;
  let covYY = 0;
  let covXY = 0;
  for (const p of centeredPoints) {
    covXX += p.x * p.x;
    covYY += p.y * p.y;
    covXY += p.x * p.y;
  }
  covXX /= n - 1;
  covYY /= n - 1;
  covXY /= n - 1;

  const determinant = covXX * covYY - covXY * covXY;
  if (Math.abs(determinant) < 1e-10) {
    return false;
  }

  const trace = covXX + covYY;
  const discriminant = Math.sqrt(trace * trace - 4 * determinant);
  const lambda1 = (trace + discriminant) / 2;
  const lambda2 = (trace - discriminant) / 2;

  let v1;
  if (covXY !== 0) {
    v1 = [lambda1 - covYY, covXY];
  } else {
    if (covXX >= covYY) {
      v1 = [1, 0];
    } else {
      v1 = [0, 1];
    }
  }
  const norm = Math.sqrt(v1[0] * v1[0] + v1[1] * v1[1]);
  v1 = [v1[0] / norm, v1[1] / norm];

  let maxD = 0;
  for (const p of centeredPoints) {
    const u = p.x * v1[0] + p.y * v1[1];
    const v = p.x * -v1[1] + p.y * v1[0];
    const d = (u * u) / lambda1 + (v * v) / lambda2;
    if (d > maxD) maxD = d;
  }

  const rx = Math.sqrt(lambda1 * maxD);
  const ry = Math.sqrt(lambda2 * maxD);

  let angle = Math.atan2(v1[1], v1[0]) * (180 / Math.PI);
  if (angle < 0) angle += 360;

  return {
    o: center,
    rx,
    ry,
    rotate: 360 - angle,
  };
};

/**
 * Listens to Ctrl + scroll and Ctrl + /- keyboard events for zoom control.
 * Prevents default browser zoom behavior and triggers custom scale function.
 *
 * @returns {Function} Unsubscriber function to remove event listeners.
 *
 * @example
 * const unsubscribe = zoomHandler();
 * // Later call unsubscribe to remove event listeners
 * unsubscribe();
 */
const zoom = (scale) => {
  /**
   * Handles wheel events for Ctrl + scroll zoom control.
   * @param {WheelEvent} event - The wheel event object.
   */
  const handleWheel = (event) => {
    if (event.ctrlKey) {
      event.preventDefault();
      scale(event.deltaY < 0 ? 1 : 0);
    }
  };

  /**
   * Handles keydown events for Ctrl + /- zoom control.
   * @param {KeyboardEvent} event - The keydown event object.
   */
  const handleKeydown = (event) => {
    if (event.ctrlKey) {
      if (event.code === "Equal" || event.code === "NumpadAdd") {
        event.preventDefault();
        scale(1);
      } else if (event.code === "Minus" || event.code === "NumpadSubtract") {
        event.preventDefault();
        scale(0);
      }
    }
  };

  // Add event listeners
  document.addEventListener("wheel", handleWheel, { passive: false });
  document.addEventListener("keydown", handleKeydown);

  // Return unsubscriber function
  return () => {
    document.removeEventListener("wheel", handleWheel);
    document.removeEventListener("keydown", handleKeydown);
  };
};

/**
 * Opens a file selection dialog and returns the text content of the selected file.
 *
 * @example
 * // Using async/await
 * const fileContent = await open();
 * if (fileContent) {
 *   console.log('File content:', fileContent);
 * } else {
 *   console.log('No file selected');
 * }
 *
 * @example
 * // Using promises
 * open().then(content => {
 *   if (content) {
 *     console.log('File content:', content);
 *   } else {
 *     console.log('No file selected');
 *   }
 * });
 *
 * @returns {Promise<string|false>} A promise that resolves to the file content as a string if a file is selected, or false if no file is selected
 */
const open = () => {
  return new Promise((resolve) => {
    const input = document.createElement("input");
    input.type = "file";
    input.accept = "*/*";

    input.onchange = (event) => {
      const file = event.target.files[0];
      if (!file) {
        resolve(false);
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        resolve(e.target.result.toString());
      };
      reader.onerror = () => {
        resolve(false);
      };
      reader.readAsText(file);
    };

    input.click();
  });
};

/**
 * Creates and downloads a file with the specified text content.
 *
 * @example
 * // Download a text file with simple content
 * save('example.txt', 'Hello, World!');
 *
 * @example
 * // Download a JSON file
 * const data = { name: 'John', age: 30 };
 * save('data.json', JSON.stringify(data, null, 2));
 *
 * @param {string} filename - The name of the file to download
 * @param {string} content - The text content to save in the file
 * @returns {void}
 */
const save = (filename, content) => {
  const blob = new Blob([content], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
};

const app = () => {
  const materials = p({
    materials: {
      0: { type: "point", props: { point: { x: 0, y: 0 } } },
    },
    next: 1,
    history: { history: {}, current: 0 },
  });
  const change = () => {};
  const add = (item, select = false) => {
    materials.produce((m) => {
      const index = m.next++;
      // todo: if should create/select
      m.materials[index] = item;
      if (select) {
        selection.produce((s) => {
          s.push(index);
        });
      }
      // todo: make ctrl z ctrl shift z work properly
      m.history.history[m.history.current++] = m.materials;
    });
  };

  const constants = { max: 10, pointradius: 5, smaller: 0.8, larger: 1.25 };
  const viewport = p({
    width: window.innerWidth,
    height: window.innerHeight,
    max: constants.max,
  });
  const selection = p([]);
  const loaded = p(false);

  const { has, map, values } = f;

  const screen = ({ x, y }) => {
    const { width, height, max } = viewport(),
      scale = width / max;
    return {
      x: x * scale + width / 2,
      y: height / 2 - y * scale,
    };
  };

  const coordinate = ({ x, y }) => {
    const { width, height, max } = viewport(),
      scale = width / max;
    return {
      x: (x - width / 2) / scale,
      y: (height / 2 - y) / scale,
    };
  };

  const compile = (materials) => {
    const { width, height, max } = viewport(),
      scale = width / max;
    // h("circle", { cx: 50, cy: 50, r: 10, fill: "lightblue" })
    const dict = {
      point({ point: _p }) {
        const p = screen(_p);
        return [
          "circle",
          {
            class: "point",
            cx: p.x,
            cy: p.y,
            // unrelated to scale
            r: constants.pointradius,
          },
        ];
      },
      // broken lines
      line({ points }) {
        return ["path", { d: line(map(points, screen)) }];
      },
      curve({ points }) {
        return ["path", { d: curve(map(points, screen)) }];
      },
      polygon({ points }) {
        return [
          "polygon",
          {
            points: map(map(points, screen), (p) => `${p.x},${p.y}`).join(" "),
          },
        ];
      },
      ellipse({ o: _o, rx, ry, rotate = 0 }) {
        const o = screen(_o);
        return [
          "ellipse",
          {
            cx: o.x,
            cy: o.y,
            rx: rx * scale,
            ry: ry * scale,
            transform: `rotate(${rotate},${o.x},${o.y})`,
          },
        ];
      },
    };

    return map(materials, ([key, material]) => {
      const { type, props } = material;
      // material must be in dict
      const element = dict[type](props);
      if (selection().includes(+key)) {
        if (!has(element[1], "class")) {
          element[1].class = "";
        }
        element[1].class += " selected";
      }

      return h(...element);
    });
  };

  // new is js keyword. so use create
  const create = {
    point(point) {
      return { type: "point", props: { point } };
    },
    line(points) {
      return { type: "line", props: { points } };
    },
    curve(points) {
      return { type: "curve", props: { points } };
    },
    polygon(points) {
      return { type: "polygon", props: { points } };
    },
    ellipse(ellipse) {
      return { type: "ellipse", props: { ...ellipse } };
    },
  };

  const measure = () => {
    viewport("width", window.innerWidth);
    viewport("height", window.innerHeight);
  };

  const scale = (direction) => {
    // larger and smaller are for the coordinate width on screen
    const larger = 0,
      smaller = 1;
    viewport.produce((v) => {
      if (direction == larger) {
        v.max *= constants.larger;
      } else if (direction == smaller) {
        v.max *= constants.smaller;
      }
    });
  };

  e(() => {
    const _resize = addEventListener("resize", measure);
    const cleanup = [];
    cleanup.push(
      () => removeEventListener("resize", _resize),
      zoom(scale),
      mouse({
        click(p) {
          add(create.point(coordinate(p)));
        },
        "ctrl click"(p) {
          add(create.point(coordinate(p)), true);
        },
      }),
      listen({
        "ctrl 0"() {
          viewport.produce((v) => {
            v.max = constants.max;
          });
        },
        l() {
          const points = map(
            selection(),
            (item) => materials().materials[item].props.point
          );
          add(create.line(points));
          map(selection(), (index) => {
            materials.produce((m) => {
              delete m.materials[index];
            });
          });
          selection([]);
        },
        c() {
          const points = map(
            selection(),
            (item) => materials().materials[item].props.point
          );
          add(create.curve(points));
          map(selection(), (index) => {
            materials.produce((m) => {
              delete m.materials[index];
            });
          });
          selection([]);
        },
        p() {
          const points = map(
            selection(),
            (item) => materials().materials[item].props.point
          );
          add(create.polygon(points));
          map(selection(), (index) => {
            materials.produce((m) => {
              delete m.materials[index];
            });
          });
          selection([]);
        },
        e() {
          const points = map(
            selection(),
            (item) => materials().materials[item].props.point
          );
          add(create.ellipse(ellipse(points)));
          map(selection(), (index) => {
            materials.produce((m) => {
              delete m.materials[index];
            });
          });
          selection([]);
        },
        esc() {
          selection([]);
        },
        "ctrl o"() {
          const m = open();
          m.then((content) => {
            if (content) {
              materials.produce((materials) => {
                materials.materials = JSON.parse(content);
              });
            }
          });
        },
        "ctrl s"() {
          save("materials.json", JSON.stringify(materials().materials));
        },
        "ctrl z"() {
          materials.produce((m) => {
            if (has(m.history.history, m.history.current - 1)) {
              m.materials = m.history.history[--m.history.current];
            }
          });
        },
      })
    );

    loaded(true);
    return () => {
      map(cleanup, (c) => c());
    };
  });

  return (
    loaded() &&
    h(
      h("style", { html: flair({ stylesheet, theme }) }),
      h(
        "svg",
        {
          class: "page",
          width: `${viewport().width}px`,
          height: `${viewport().height}px`,
          viewBox: `0 0 ${viewport().width} ${viewport().height}`,
        },
        ...compile(materials().materials)
      )
    )
  );
};

r(app, document.body);
</script>
</html>
