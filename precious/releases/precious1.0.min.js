const precious=t=>{const e={"=":"=","!=":"\\neq","<":"<",">":">","<=":"\\leq",">=":"\\geq","â‰ˆ":"\\approx","~":"\\sim",alpha:"\\alpha",beta:"\\beta",gamma:"\\gamma",delta:"\\delta",epsilon:"\\epsilon",zeta:"\\zeta",eta:"\\eta",theta:"\\theta",iota:"\\iota",kappa:"\\kappa",lambda:"\\lambda",mu:"\\mu",nu:"\\nu",xi:"\\xi",omicron:"\\omicron",pi:"\\pi",rho:"\\rho",sigma:"\\sigma",tau:"\\tau",upsilon:"\\upsilon",phi:"\\phi",chi:"\\chi",psi:"\\psi",omega:"\\omega",Gamma:"\\Gamma",Delta:"\\Delta",Theta:"\\Theta",Lambda:"\\Lambda",Xi:"\\Xi",Pi:"\\Pi",Sigma:"\\Sigma",Upsilon:"\\Upsilon",Phi:"\\Phi",Psi:"\\Psi",Omega:"\\Omega",infinity:"\\infty",infty:"\\infty",partial:"\\partial",nabla:"\\nabla",in:"\\in",notin:"\\notin",subset:"\\subset",subseteq:"\\subseteq",supset:"\\supset",supseteq:"\\supseteq",cup:"\\cup",cap:"\\cap",emptyset:"\\emptyset",forall:"\\forall",exists:"\\exists",nexists:"\\nexists",and:"\\land",or:"\\lor",not:"\\lnot",implies:"\\implies",iff:"\\iff",int:"\\int",oint:"\\oint",sum:"\\sum",prod:"\\prod",lim:"\\lim",nabla:"\\nabla",langle:"\\langle",rangle:"\\rangle",to:"\\to",rightarrow:"\\rightarrow",leftarrow:"\\leftarrow",leftrightarrow:"\\leftrightarrow",Rightarrow:"\\Rightarrow",Leftarrow:"\\Leftarrow",Leftrightarrow:"\\Leftrightarrow",cdot:"\\cdot",pm:"\\pm",mp:"\\mp",times:"\\times",div:"\\div",circ:"\\circ",deg:"^\\circ",prime:"\\prime",ldots:"\\ldots",cdots:"\\cdots",vdots:"\\vdots",ddots:"\\ddots",sqrt:"\\sqrt",perp:"\\perp",parallel:"\\parallel",angle:"\\angle",triangle:"\\triangle",congruent:"\\cong",similar:"\\sim",propto:"\\propto"};for(const t of Object.keys(e))e[t]=` ${e[t]} `;const r={"^":(t,e)=>`{${t}}^{${e}}`,_:(t,e)=>`{${t}}_{${e}}`,"//":(t,e)=>`\\lfloor\\frac{${t}}{${e}}\\rfloor`,"%%":(t,e)=>`${t} \\bmod ${e}`,"*":(t,e)=>`${t} \\cdot ${e}`,"/":(t,e)=>`\\frac{${a(t)}}{${a(e)}}`},o={sqrt:t=>`\\sqrt{${t}}`,root:(t,e)=>`\\sqrt{${t}}{${e}}`,log:(t,e)=>`\\log_{${t}}{${i(e)}}`,ln:t=>`\\ln{${i(t)}}`,sin:t=>`\\sin{${i(t)}}`,cos:t=>`\\cos{${i(t)}}`,tan:t=>`\\tan{${i(t)}}`,abs:t=>`|${t}|`,floor:t=>`\\lfloor ${t} \\rfloor`,ceil:t=>`\\lceil ${t} \\rceil`},i=t=>{let e=!1;return["+","-","\\times","\\cdot","\\div"].map((r=>{t.includes(r)&&(e=!0)})),e?`(${t})`:t},a=t=>{if(t.length<2||"("!==t[0]||")"!==t[t.length-1])return t;let e=0;for(let r=0;r<t.length;r++)if("("===t[r])e++;else if(")"===t[r]&&(e--,0===e&&r!==t.length-1))return t;return 0===e?t.slice(1,-1):t},l=t=>/^[0-9.]+$/.test(t)?"number":/^[a-zA-Z]+$/.test(t)?"variable":["(",")","[","]","{","}"].includes(t)?Symbol():"symbol",s=(t,e,r,o)=>{for(;;){let i=-1,a=-1;for(let e=0;e<t.length;e++)if("("===t[e])i=e;else if(")"===t[e]){if(-1===i)throw new Error("Unmatched closing parenthesis");a=e;break}if(-1===a){if(-1!==i)throw new Error("Unmatched opening parenthesis");break}const l=t.slice(i+1,a);let n=null;if(i>0&&t[i-1]in o&&(n=t[i-1]),n){const p=[];let c=0,m=0;for(let t=0;t<l.length;t++){const e=l[t];"("===e?m++:")"===e?m--:","===e&&0===m&&(p.push(l.slice(c,t)),c=t+1)}p.push(l.slice(c));const g=p.map((t=>s(t,e,r,o))),h=o[n](...g);t.splice(i-1,a-i+2,h)}else{const n=`(${s(l,e,r,o)})`;t.splice(i,a-i+1,n)}}for(const o of e){const e=new Set(o);let i=0;for(;i<t.length;)if(e.has(t[i])){if(i-1<0||i+1>=t.length)throw new Error(`Operator '${t[i]}' at position ${i} is missing an operand`);const e=t[i-1],o=t[i+1],a=t[i],l=r[a](e,o);t.splice(i-1,3,l),i=0}else i++}return t.join("")};return t=((t,e)=>t.map((t=>e[t.replaceAll(" ","")]??t)))(t=(t=(t=>{if(0===t.length)return[];const e=[];let r=t[0],o=l(t[0]);for(let i=1;i<t.length;i++){const a=t[i],s=l(a);s===o?r+=a:(e.push(r),r=a,o=s)}return e.push(r),e})(t=t.split("\n").map((t=>t.split(/\s+/).join(" "))).join("\\\\"))).map((t=>1==t.length?t:t.replaceAll(" ",""))),e),((t,e=!1)=>{try{return katex.renderToString(t,{displayMode:e,throwOnError:!1,errorColor:"#cc0000",strict:"warn",trust:!1,output:"mathml",macros:{}})}catch(t){return`<span style="color: #cc0000;">LaTeX Error: ${t.message}</span>`}})(t=s(t,[["_"],["^"],["//","%%"],["*","/"]],r,o))};